<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en"><script src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/widgets.js" id="twitter-wjs"></script><script id="bug.surrogate.20">FB={Event:{subscribe:function(){}},UIServer:{},XFBML:{parse:function(){}},init:function(){},__noSuchMethod__:function(){}};</script><script src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/all.js" id="facebook-jssdk"></script><script id="bug.surrogate.1">var urchinTracker=function(){},_gaq={push:function(){try {if(arguments[0][0]=='_link')window.location.href=arguments[0][1]}catch(er){}}},_gat={_createTracker:function(){}, _getTracker:function(){return{__noSuchMethod__:function(){},_link:function(o){if(o)location.href=o;},_linkByPost:function(){return true;},_getLinkerUrl:function(o){return o;},_trackEvent:function(){}}}};</script><head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

	<title>The Flask Mega-Tutorial, Part VIII: Followers, Contacts And Friends - miguelgrinberg.com</title>

	<meta name="description" content="miguelgrinberg.com">
	<meta name="copyright" content="Copyright (c) 2012 Miguel Grinberg">
	<meta name="author" content="Miguel Grinberg">
    
    <meta name="keywords" content="python, programming, flask, web, tutorial, database, self referential, relationship">
    
    <link rel="shortcut icon" href="http://blog.miguelgrinberg.com/static/favicon.ico">
	<link rel="alternate" type="application/rss+xml" href="http://blog.miguelgrinberg.com/feed" title="miguelgrinberg.com RSS feed">
    <link href="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/prettify.css" type="text/css" rel="stylesheet">
    <link href="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/colorbox.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/jquery_002.js"></script>
	<script type="text/javascript" src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/jquery.js"></script>
    <script type="text/javascript" src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/moment.js"></script>
    <script type="text/javascript" src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/prettify.js"></script>
    <link href="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/bootstrap.css" rel="stylesheet" media="screen">
    <link href="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/bootstrap-responsive.css" rel="stylesheet">
    <link href="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/style.css" rel="stylesheet" type="text/css">
    <script src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/bootstrap.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style type="text/css" media="screen, print, projection">
    </style>
    
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-4777284-15']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    
    <script type="text/javascript">
        $(document).ready(function(){
            $(".gallery").colorbox({rel:".gallery",maxWidth:"95%",maxHeight:"95%",scalePhotos:true});
            // add prettyprint class to all <pre><code></code></pre> blocks
            var prettify = false;
            $("pre code").parent().each(function() {
                $(this).addClass('prettyprint');
                prettify = true;
            });
            prettyPrint();
        });
    </script>
<style type="text/css">.recaptchatable td img{display:block}.recaptchatable .recaptcha_r1_c1{background:url('http://www.google.com/recaptcha/api/img/white/sprite.png') 0 -63px no-repeat;width:318px;height:9px}.recaptchatable .recaptcha_r2_c1{background:url('http://www.google.com/recaptcha/api/img/white/sprite.png') -18px 0 no-repeat;width:9px;height:57px}.recaptchatable .recaptcha_r2_c2{background:url('http://www.google.com/recaptcha/api/img/white/sprite.png') -27px 0 no-repeat;width:9px;height:57px}.recaptchatable .recaptcha_r3_c1{background:url('http://www.google.com/recaptcha/api/img/white/sprite.png') 0 0 no-repeat;width:9px;height:63px}.recaptchatable .recaptcha_r3_c2{background:url('http://www.google.com/recaptcha/api/img/white/sprite.png') -18px -57px no-repeat;width:300px;height:6px}.recaptchatable .recaptcha_r3_c3{background:url('http://www.google.com/recaptcha/api/img/white/sprite.png') -9px 0 no-repeat;width:9px;height:63px}.recaptchatable .recaptcha_r4_c1{background:url('http://www.google.com/recaptcha/api/img/white/sprite.png') -43px 0 no-repeat;width:171px;height:49px}.recaptchatable .recaptcha_r4_c2{background:url('http://www.google.com/recaptcha/api/img/white/sprite.png') -36px 0 no-repeat;width:7px;height:57px}.recaptchatable .recaptcha_r4_c4{background:url('http://www.google.com/recaptcha/api/img/white/sprite.png') -214px 0 no-repeat;width:97px;height:57px}.recaptchatable .recaptcha_r7_c1{background:url('http://www.google.com/recaptcha/api/img/white/sprite.png') -43px -49px no-repeat;width:171px;height:8px}.recaptchatable .recaptcha_r8_c1{background:url('http://www.google.com/recaptcha/api/img/white/sprite.png') -43px -49px no-repeat;width:25px;height:8px}.recaptchatable .recaptcha_image_cell center img{height:57px}.recaptchatable .recaptcha_image_cell center{height:57px}.recaptchatable .recaptcha_image_cell{background-color:white;height:57px}#recaptcha_area,#recaptcha_table{width:318px!important}.recaptchatable,#recaptcha_area tr,#recaptcha_area td,#recaptcha_area th{margin:0!important;border:0!important;padding:0!important;border-collapse:collapse!important;vertical-align:middle!important}.recaptchatable *{margin:0;padding:0;border:0;font-family:helvetica,sans-serif;font-size:8pt;color:black;position:static;top:auto;left:auto;right:auto;bottom:auto}.recaptchatable #recaptcha_image{position:relative;margin:auto}.recaptchatable #recaptcha_image #recaptcha_challenge_image{display:block}.recaptchatable #recaptcha_image #recaptcha_ad_image{display:block;position:absolute;top:0}.recaptchatable img{border:0!important;margin:0!important;padding:0!important}.recaptchatable a,.recaptchatable a:hover{cursor:pointer;outline:none;border:0!important;padding:0!important;text-decoration:none;color:blue;background:none!important;font-weight:normal}.recaptcha_input_area{position:relative!important;width:153px!important;height:45px!important;margin-left:7px!important;margin-right:7px!important;background:none!important}.recaptchatable label.recaptcha_input_area_text{margin:0!important;padding:0!important;position:static!important;top:auto!important;left:auto!important;right:auto!important;bottom:auto!important;background:none!important;height:auto!important;width:auto!important}.recaptcha_theme_red label.recaptcha_input_area_text,.recaptcha_theme_white label.recaptcha_input_area_text{color:black!important}.recaptcha_theme_blackglass label.recaptcha_input_area_text{color:white!important}.recaptchatable #recaptcha_response_field{width:153px!important;position:relative!important;bottom:7px!important;padding:0!important;margin:15px 0 0 0!important;font-size:10pt}.recaptcha_theme_blackglass #recaptcha_response_field,.recaptcha_theme_white #recaptcha_response_field{border:1px solid gray}.recaptcha_theme_red #recaptcha_response_field{border:1px solid #cca940}.recaptcha_audio_cant_hear_link{font-size:7pt;color:black}.recaptchatable{line-height:1!important}#recaptcha_instructions_error{color:red!important}.recaptcha_only_if_privacy{float:right;text-align:right}#recaptcha-ad-choices{position:absolute;height:15px;top:0;right:0}#recaptcha-ad-choices img{height:15px}.recaptcha-ad-choices-collapsed{width:15px;height:15px;display:block}.recaptcha-ad-choices-expanded{width:75px;height:15px;display:none}#recaptcha-ad-choices:hover .recaptcha-ad-choices-collapsed{display:none}#recaptcha-ad-choices:hover .recaptcha-ad-choices-expanded{display:block}

.recaptcha_is_showing_audio .recaptcha_only_if_image,.recaptcha_isnot_showing_audio .recaptcha_only_if_audio,.recaptcha_had_incorrect_sol .recaptcha_only_if_no_incorrect_sol,.recaptcha_nothad_incorrect_sol .recaptcha_only_if_incorrect_sol{display:none !important}</style><style>#sjbdmztoiakqzbwisrcjdtbzantxeetjgreqv{border:solid 2px #fff !important;color:#fff !important;display:block !important;height:auto !important;margin:0 !important;opacity:0.9 !important;padding:7px 10px !important;position:fixed !important;visibility:visible !important;width:auto !important;z-index:2147483647 !important;-moz-border-radius:5px !important;border-radius:5px !important;-moz-box-shadow:0px 0px 20px #000 !important;box-shadow:0px 0px 20px #000 !important;}.sjbdmztoiakqzbwisrcjdtbzantxeetjgreqv-blocked{color:#777 !important;display:inline !important;text-decoration:line-through !important;}#sjbdmztoiakqzbwisrcjdtbzantxeetjgreqv span{background:transparent !important;}#sjbdmztoiakqzbwisrcjdtbzantxeetjgreqv div{border:0 !important;margin:0 !important;padding:0 !important;width:auto !important;letter-spacing:normal !important;font:13px Arial,Helvetica !important;text-align:left !important;text-shadow:none !important;text-transform:none !important;word-spacing:normal !important;}#sjbdmztoiakqzbwisrcjdtbzantxeetjgreqv a{font-weight:normal !important;background:none !important;text-decoration:underline !important;color:#fff !important;}@media print{#sjbdmztoiakqzbwisrcjdtbzantxeetjgreqv{display:none !important;}}</style></head>
<body style="padding-top: 40px;">
<!-- facebook sdk -->
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<!-- google plus sdk -->
<script type="text/javascript" src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/plusone.js"></script>
<!-- twitter sdk -->
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
<!-- linkedin sdk -->
<script src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/in.js" type="text/javascript"></script>
<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
            <a class="brand" href="http://blog.miguelgrinberg.com/">miguelgrinberg.com</a>
            <ul class="nav">
                <li><a href="http://blog.miguelgrinberg.com/">Home</a></li>
                <li><a href="http://blog.miguelgrinberg.com/post/about-me">About Me</a></li>
                <li><a href="http://blog.miguelgrinberg.com/post/about-this-blog">About This Blog</a></li>
				
            </ul>
            <div class="nav pull-right">
                <p class="navbar-text">
                    <a type="application/rss+xml" href="http://blog.miguelgrinberg.com/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/rss.png" alt="RSS Feed" title="RSS Feed"></a>
                    <a href="https://www.facebook.com/miguelgrinbergblog"><img src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/facebook.png" alt="Facebook" title="Facebook"></a>
                    <a href="https://plus.google.com/u/0/117786742456929977820"><img class="yfapaxbwxrlpkwtnwicp" src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/googleplus.png" alt="Google+" title="Google+"></a>
                    <a href="http://www.linkedin.com/in/miguelgrinberg"><img class="yfapaxbwxrlpkwtnwicp" src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/linkedin.png" alt="LinkedIn" title="LinkedIn"></a>
                    <a href="https://twitter.com/#%21/miguelgrinberg"><img src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/twitter.png" alt="Twitter" title="Twitter"></a>
                </p>
            </div>
        </div>
    </div>
</div>
<div id="banner"></div>
<div class="container">
    <div class="row">
        <div class="span8">
            <div id="main">
                
                
                
                
                

<div class="post">
<p class="date">
<script type="text/javascript">
document.write(moment("2012-09-02T01:23:49Z").format("LL"));
</script>September 1 2012
</p>
<div class="social-outer">
    <div class="social">
        <div class="social-box"><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-viii-followers-contacts-and-friends" data-via="miguelgrinberg" data-count="vertical">Tweet</a></div>
        <div class="social-box" style="padding-left: 6px;"><div style="display: block;" class="fb-like" data-href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-viii-followers-contacts-and-friends" data-send="false" data-layout="box_count" data-width="450" data-show-faces="false" data-font="verdana"><iframe style="width: 30px; height: 19px; border: 0px none;" id="pybdmocgcxlphbhensjjorltkisfxrcqp"></iframe></div></div>
        <div class="social-box"><g:plusone href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-viii-followers-contacts-and-friends" size="tall"></g:plusone></div>
        <div class="social-box"><script type="IN/Share" data-url="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-viii-followers-contacts-and-friends" data-counter="top"></script></div>
    </div>
</div>
<h1 class="post-title">The Flask Mega-Tutorial, Part VIII: Followers, Contacts And Friends</h1>
<div class="posted">Posted by <span class="label label-important"><a href="http://blog.miguelgrinberg.com/author/Miguel%20Grinberg">Miguel Grinberg</a></span> under <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Programming">Programming</a></span>, <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Python">Python</a></span>, <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Flask">Flask</a></span>. </div>
<div class="post_body"><p>This is the eighth article in the series in which I document my experience writing web applications in <a href="http://python.org/">Python</a> using the <a href="http://flask.pocoo.org/">Flask</a> microframework.</p>
<p>The goal of the tutorial series is to develop a decently featured 
microblogging application that demonstrating total lack of originality I
 have decided to call <code>microblog</code>.</p>
<p>Here is an index of all the articles in the series that have been published to date:</p>
<ul>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-i-hello-world">Part I: Hello, World!</a></li>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-ii-templates">Part II: Templates</a></li>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-iii-web-forms">Part III: Web Forms</a></li>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-iv-database">Part IV: Database</a></li>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-v-user-logins">Part V: User Logins</a></li>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-vi-profile-page-and-avatars">Part VI: Profile Page And Avatars</a></li>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-vii-unit-testing">Part VII: Unit Testing</a></li>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-viii-followers-contacts-and-friends">Part VIII: Followers, Contacts And Friends</a> (this article)</li>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-ix-pagination">Part IX: Pagination</a></li>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-x-full-text-search">Part X: Full Text Search</a></li>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xi-email-support">Part XI: Email Support</a></li>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xii-facelift">Part XII: Facelift</a></li>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xiii-dates-and-times">Part XIII: Dates and Times</a></li>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xiv-i18n-and-l10n">Part XIV: I18n and L10n</a></li>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xv-ajax">Part XV: Ajax</a></li>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xvi-debugging-testing-and-profiling">Part XVI: Debugging, Testing and Profiling</a></li>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xvii-deployment-on-linux-even-on-the-raspberry-pi">Part XVII: Deployment on Linux (even on the Raspberry Pi!)</a></li>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xviii-deployment-on-the-heroku-cloud">Part XVIII: Deployment on the Heroku Cloud</a></li>
</ul>
<h2>Recap</h2>
<p>Our little <code>microblog</code> application has been growing little
 by little, and by now we have touched on most of the topics that are 
required to complete the application.</p>
<p>Today we are going to work on our database some more. Each user of 
our application needs to be able to select which other users he or she 
wants to follow, so our database must be able to keep track of who is 
following who. All social applications have this feature in some form. 
Some call it Contacts, others Connections, Friends, Buddies or 
Followers. Other sites use this same idea to implement Allowed and 
Ignored user lists. We will call them Followers, but the implementation 
is the same regardless of the name.</p>
<h2>Design of the 'Follower' feature</h2>
<p>Before we start coding, let's think about  the functionality that we want to obtain from this feature.</p>
<p>Let's start with the most obvious one. We want our users to easily maintain a list of <em>followed</em> people. </p>
<p>Looking at it from the other side, for each user we want to know the list of its <em>followers</em>.</p>
<p>We also want to have a way to query if a user <em>is following</em> or <em>is followed</em> by another user.</p>
<p>Users will click a "follow" link in the profile page of any other 
user to begin following that user. Likewise, they'll click a "unfollow" 
link to stop following a user.</p>
<p>The final requirement is that given a user we can easily query the 
database to obtain all the posts that belong to the followed users.</p>
<p>So, if you thought this was going to be a quick and easy article, think again!</p>
<h2>Database relationships</h2>
<p>We said we wanted to have all users to have "followed" and 
"followers" lists. Unfortunately, a relational database does not have a <code>list</code> type, all we have are tables with records and relationships between records.</p>
<p>We already have a table in our database to represent users, so what's
 left is to come up with the proper relationship type that can model the
 follower/followed link. This is a good time to review the three 
database relationship types:</p>
<h3>One-to-many</h3>
<p>We have already seen a one-to-many relationship in the <a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-iv-database">previous database article</a>. Here is the diagram:</p>
<p><img alt="one-to-many" src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/flask-mega-tutorial-part-iv-2.png"></p>
<p>The two entities associated with this relationship are <code>users</code> and <code>posts</code>. We say that a user has <em>many</em> posts, and a post has <em>one</em> user. The relationship is represented in the database with the use of a <em>foreign key</em> on the "many" side. In the above example the foreign key is the <code>user_id</code> field added to the <code>posts</code> table. This field links each post to the record of its author in the user table.</p>
<p>It is pretty clear that the <code>user_id</code> field provides 
direct access to the author of a given post, but what about the reverse?
 For the relationship to be useful we should be able to get the list of 
posts written by a given user. Turns out the <code>user_id</code> field in the <code>posts</code>
 table is enough to answer this question, as databases have indexes that
 allow for efficient queries such us "retrieve all posts that have a 
user_id of X".</p>
<h3>Many-to-many</h3>
<p>A many-to-many relationship is a bit more complex. As an example, consider a database that has <code>students</code> and <code>teachers</code>. We can say that a student has <em>many</em> teachers, and a teacher has <em>many</em> students. It's like two overlapped one-to-many relationships from both ends.</p>
<p>For a relationship of this type we should be able to query the 
database and obtain the list of teachers that teach a student, and the 
list of students in a teacher's class. Turns out this is pretty tricky 
to represent, it cannot be done by adding foreign keys to the existing 
tables.</p>
<p>The representation of a many-to-many relationship requires the use of an auxiliary table called an <em>association table</em>. Here is how the database would look for the students and teachers example:</p>
<p><img alt="many-to-many" src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/flask-mega-tutorial-part-viii-1.png"></p>
<p>While it may not seem straightforward, the association table with its
 two foreign keys is able to efficiently answer many types of queries, 
such as:</p>
<ul>
<li>Who are the teachers of student S?</li>
<li>Who are the students of teacher T?</li>
<li>How many students does teacher T have?</li>
<li>How many teachers does student S have?</li>
<li>Is teacher T teaching student S?</li>
<li>Is student S in teacher T's class?</li>
</ul>
<h3>One-to-one</h3>
<p>A one-to-one relationship is a special case of a one-to-many. The 
representation is similar, but a constrain is added to the database to 
prevent the "many" side to have more than one link.</p>
<p>While there are cases in which this type of relationship is useful, 
it isn't as common as the other two types, since any time one record in a
 table maps to one record in another table it can be argued that it may 
make sense for these two tables to be merged into one.</p>
<h2>Representing followers and followed</h2>
<p>From the above relationships we can easily determine that the proper 
data model is the many-to-many relationship, because a user follows <em>many</em> users, and a user has <em>many</em>
 followers. But there is a twist. We want to represent users following 
other users, so we just have users. So what should we use as the second 
entity of the many-to-many relationship?</p>
<p>Well, the second entity of the relationship is also the users. A 
relationship in which instances of an entity are linked to other 
instances of the same entity is called a <em>self-referential relationship</em>, and that is exactly what we need here.</p>
<p>Here is a diagram of our many-to-many relationship:</p>
<p><img alt="many-to-many" src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/flask-mega-tutorial-part-viii-2.png"></p>
<p>The <code>followers</code> table is our association table. The 
foreign keys are both pointing to the user table, since we are linking 
users to users. Each record in this table represents one link between a 
follower user and a followed user. Like the students and teachers 
example, a setup like this one allows our database to answer all the 
questions about followed and followers that we will need. Pretty neat.</p>
<h2>Database model</h2>
<p>The changes to our database model aren't that big. We start by adding the <code>followers</code> table (file <code>app/models.py</code>):</p>
<pre class="prettyprint"><code><span class="pln">followers </span><span class="pun">=</span><span class="pln"> db</span><span class="pun">.</span><span class="typ">Table</span><span class="pun">(</span><span class="str">'followers'</span><span class="pun">,</span><span class="pln">
    db</span><span class="pun">.</span><span class="typ">Column</span><span class="pun">(</span><span class="str">'follower_id'</span><span class="pun">,</span><span class="pln"> db</span><span class="pun">.</span><span class="typ">Integer</span><span class="pun">,</span><span class="pln"> db</span><span class="pun">.</span><span class="typ">ForeignKey</span><span class="pun">(</span><span class="str">'user.id'</span><span class="pun">)),</span><span class="pln">
    db</span><span class="pun">.</span><span class="typ">Column</span><span class="pun">(</span><span class="str">'followed_id'</span><span class="pun">,</span><span class="pln"> db</span><span class="pun">.</span><span class="typ">Integer</span><span class="pun">,</span><span class="pln"> db</span><span class="pun">.</span><span class="typ">ForeignKey</span><span class="pun">(</span><span class="str">'user.id'</span><span class="pun">))</span><span class="pln">
</span><span class="pun">)</span></code></pre>
<p>This is a direct translation of the association table from our 
diagram. Note that we are not declaring this table as a model like we 
did for <code>users</code> and <code>posts</code>. Since this is an 
auxiliary table that has no data other than the foreign keys, we use the
 lower level APIs in flask-sqlalchemy to create the table without an 
associated model.</p>
<p>Next we define the many-to-many relationship in the <code>users</code> table (file <code>app/models.py</code>):</p>
<pre class="prettyprint"><code><span class="kwd">class</span><span class="pln"> </span><span class="typ">User</span><span class="pun">(</span><span class="pln">db</span><span class="pun">.</span><span class="typ">Model</span><span class="pun">):</span><span class="pln">
    id </span><span class="pun">=</span><span class="pln"> db</span><span class="pun">.</span><span class="typ">Column</span><span class="pun">(</span><span class="pln">db</span><span class="pun">.</span><span class="typ">Integer</span><span class="pun">,</span><span class="pln"> primary_key </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">True</span><span class="pun">)</span><span class="pln">
    nickname </span><span class="pun">=</span><span class="pln"> db</span><span class="pun">.</span><span class="typ">Column</span><span class="pun">(</span><span class="pln">db</span><span class="pun">.</span><span class="typ">String</span><span class="pun">(</span><span class="lit">64</span><span class="pun">),</span><span class="pln"> unique </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">True</span><span class="pun">)</span><span class="pln">
    email </span><span class="pun">=</span><span class="pln"> db</span><span class="pun">.</span><span class="typ">Column</span><span class="pun">(</span><span class="pln">db</span><span class="pun">.</span><span class="typ">String</span><span class="pun">(</span><span class="lit">120</span><span class="pun">),</span><span class="pln"> index </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">True</span><span class="pun">,</span><span class="pln"> unique </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">True</span><span class="pun">)</span><span class="pln">
    role </span><span class="pun">=</span><span class="pln"> db</span><span class="pun">.</span><span class="typ">Column</span><span class="pun">(</span><span class="pln">db</span><span class="pun">.</span><span class="typ">SmallInteger</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> ROLE_USER</span><span class="pun">)</span><span class="pln">
    posts </span><span class="pun">=</span><span class="pln"> db</span><span class="pun">.</span><span class="pln">relationship</span><span class="pun">(</span><span class="str">'Post'</span><span class="pun">,</span><span class="pln"> backref </span><span class="pun">=</span><span class="pln"> </span><span class="str">'author'</span><span class="pun">,</span><span class="pln"> lazy </span><span class="pun">=</span><span class="pln"> </span><span class="str">'dynamic'</span><span class="pun">)</span><span class="pln">
    about_me </span><span class="pun">=</span><span class="pln"> db</span><span class="pun">.</span><span class="typ">Column</span><span class="pun">(</span><span class="pln">db</span><span class="pun">.</span><span class="typ">String</span><span class="pun">(</span><span class="lit">140</span><span class="pun">))</span><span class="pln">
    last_seen </span><span class="pun">=</span><span class="pln"> db</span><span class="pun">.</span><span class="typ">Column</span><span class="pun">(</span><span class="pln">db</span><span class="pun">.</span><span class="typ">DateTime</span><span class="pun">)</span><span class="pln">
    followed </span><span class="pun">=</span><span class="pln"> db</span><span class="pun">.</span><span class="pln">relationship</span><span class="pun">(</span><span class="str">'User'</span><span class="pun">,</span><span class="pln"> 
        secondary </span><span class="pun">=</span><span class="pln"> followers</span><span class="pun">,</span><span class="pln"> 
        primaryjoin </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">followers</span><span class="pun">.</span><span class="pln">c</span><span class="pun">.</span><span class="pln">follower_id </span><span class="pun">==</span><span class="pln"> id</span><span class="pun">),</span><span class="pln"> 
        secondaryjoin </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">followers</span><span class="pun">.</span><span class="pln">c</span><span class="pun">.</span><span class="pln">followed_id </span><span class="pun">==</span><span class="pln"> id</span><span class="pun">),</span><span class="pln"> 
        backref </span><span class="pun">=</span><span class="pln"> db</span><span class="pun">.</span><span class="pln">backref</span><span class="pun">(</span><span class="str">'followers'</span><span class="pun">,</span><span class="pln"> lazy </span><span class="pun">=</span><span class="pln"> </span><span class="str">'dynamic'</span><span class="pun">),</span><span class="pln"> 
        lazy </span><span class="pun">=</span><span class="pln"> </span><span class="str">'dynamic'</span><span class="pun">)</span></code></pre>
<p>The setup of the relationship is non-trivial and requires some 
explanation. Like we did for the one-to-many relationship in the 
previous article, we are using the <code>db.relationship</code> function to define the relationship. We will be linking <code>User</code> instances to other <code>User</code>
 instances, so as a convention let's say that for a pair of linked users
 in this relationship the left side user is following the right side 
user. We define the relationship as seen from the left side entity with 
the name <code>followed</code>, because when we query this relationship 
from the left side we will get the list of followed users. Let's examine
 all the arguments to the <code>db.relationship()</code> call one by one:</p>
<ul>
<li><code>'User'</code> is the right side entity that is in this 
relationship (the left side entity is the parent class). Since we are 
defining a self-referential relationship we use the same class on both 
sides.</li>
<li><code>secondary</code> indicates the association table that is used for this relationship.</li>
<li><code>primaryjoin</code> indicates the condition that links the left side entity (the follower user) with the association table. Note that because the <code>followers</code> table is not a model there is a slightly odd syntax required to get to the field name.</li>
<li><code>secondaryjoin</code> indicates the condition that links the right side entity (the followed user) with the association table.</li>
<li><code>backref</code> defines how this relationship will be accessed from the right side entity. We said that for a given user the query named <code>followed</code> returns all the right side users that have the target user on the left side. The back reference will be called <code>followers</code> and will return all the left side users that are linked to the target user in the right side. The additional <code>lazy</code> argument indicates the execution mode for this query. A mode of <code>dynamic</code>
 sets up the query to not run until specifically requested. This is 
useful for performance reasons, and also because we will be able to take
 this query and modify it before it executes. More about this later.</li>
<li><code>lazy</code> is similar to the parameter of the same name in the <code>backref</code>, but this one applies to the regular query instead of the back reference.</li>
</ul>
<p>Don't desperate if this is hard to understand. We will see how to use
 these queries in a moment, and then everything will become clearer.</p>
<p>Since we have made updates to the database, we now have to generate a new migration:</p>
<pre class="prettyprint"><code><span class="pun">./</span><span class="pln">db_migrate</span><span class="pun">.</span><span class="pln">py</span></code></pre>
<p>And with this we have completed the database changes. But we have quite a bit of coding left to do.</p>
<h2>Adding and removing 'follows'</h2>
<p>To promote reusability, we will implement the <code>follow</code> and <code>unfollow</code> functionality in the <code>User</code>
 model instead of doing it directly in view functions. That way we can 
use this feature for the actual application (invoking it from the view 
functions) and also from our unit testing framework. As a matter of 
principle, it is always best to move the logic of our application away 
from view functions and into models, because that simplifies the 
testing. You want to have your view functions be as simple as possible, 
because those are harder to test in an automated way.</p>
<p>Below is the code to add and remove relationships, defined as methods of the <code>User</code> model (file <code>app/models.py</code>):</p>
<pre class="prettyprint"><code><span class="kwd">class</span><span class="pln"> </span><span class="typ">User</span><span class="pun">(</span><span class="pln">db</span><span class="pun">.</span><span class="typ">Model</span><span class="pun">):</span><span class="pln">
    </span><span class="com">#...</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> follow</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> user</span><span class="pun">):</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">is_following</span><span class="pun">(</span><span class="pln">user</span><span class="pun">):</span><span class="pln">
            </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">followed</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="pln">user</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">self</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> unfollow</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> user</span><span class="pun">):</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">is_following</span><span class="pun">(</span><span class="pln">user</span><span class="pun">):</span><span class="pln">
            </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">followed</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="pln">user</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">self</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> is_following</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> user</span><span class="pun">):</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">followed</span><span class="pun">.</span><span class="pln">filter</span><span class="pun">(</span><span class="pln">followers</span><span class="pun">.</span><span class="pln">c</span><span class="pun">.</span><span class="pln">followed_id </span><span class="pun">==</span><span class="pln"> user</span><span class="pun">.</span><span class="pln">id</span><span class="pun">).</span><span class="pln">count</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span></code></pre>
<p>These methods are amazingly simple, thanks to the power of sqlalchemy
 who does a lot of work under the covers. We just add or remove items 
from the <code>followed</code> relationship and sqlalchemy takes care of managing the association table for us.</p>
<p>The <code>follow</code> and <code>unfollow</code> methods are defined so that they return an object when they succeed or <code>None</code> when they fail. When an object is returned, this object has to be added to the database session and committed.</p>
<p>The <code>is_following</code> method does a lot in its single line of code. We are taking the <code>followed</code> relationship query, which returns all the <code>(follower, followed)</code> pairs that have our user as the follower, and we filter it by the followed user. This is possible because the <code>followed</code> relationship has a lazy mode of <code>dynamic</code>, so instead of being the result of the query, this is the actual query object, before execution.</p>
<p>The return from the <code>filter</code> call is the modified query, still without having executed. So we then call <code>count()</code>
 on this query, and now the query will execute and return the number of 
records found. If we get one, then we know a link between these two uses
 is already present. If we get none then we know a link does not exist.</p>
<h2>Testing</h2>
<p>Let's write a test for our unit testing framework that exercises all that we have built so far (file <code>tests.py</code>):</p>
<pre class="prettyprint"><code><span class="kwd">class</span><span class="pln"> </span><span class="typ">TestCase</span><span class="pun">(</span><span class="pln">unittest</span><span class="pun">.</span><span class="typ">TestCase</span><span class="pun">):</span><span class="pln">
    </span><span class="com">#...</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> test_follow</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">):</span><span class="pln">
        u1 </span><span class="pun">=</span><span class="pln"> </span><span class="typ">User</span><span class="pun">(</span><span class="pln">nickname </span><span class="pun">=</span><span class="pln"> </span><span class="str">'john'</span><span class="pun">,</span><span class="pln"> email </span><span class="pun">=</span><span class="pln"> </span><span class="str">'john@example.com'</span><span class="pun">)</span><span class="pln">
        u2 </span><span class="pun">=</span><span class="pln"> </span><span class="typ">User</span><span class="pun">(</span><span class="pln">nickname </span><span class="pun">=</span><span class="pln"> </span><span class="str">'susan'</span><span class="pun">,</span><span class="pln"> email </span><span class="pun">=</span><span class="pln"> </span><span class="str">'susan@example.com'</span><span class="pun">)</span><span class="pln">
        db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">u1</span><span class="pun">)</span><span class="pln">
        db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">u2</span><span class="pun">)</span><span class="pln">
        db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">commit</span><span class="pun">()</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> u1</span><span class="pun">.</span><span class="pln">unfollow</span><span class="pun">(</span><span class="pln">u2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">None</span><span class="pln">
        u </span><span class="pun">=</span><span class="pln"> u1</span><span class="pun">.</span><span class="pln">follow</span><span class="pun">(</span><span class="pln">u2</span><span class="pun">)</span><span class="pln">
        db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">u</span><span class="pun">)</span><span class="pln">
        db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">commit</span><span class="pun">()</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> u1</span><span class="pun">.</span><span class="pln">follow</span><span class="pun">(</span><span class="pln">u2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">None</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> u1</span><span class="pun">.</span><span class="pln">is_following</span><span class="pun">(</span><span class="pln">u2</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> u1</span><span class="pun">.</span><span class="pln">followed</span><span class="pun">.</span><span class="pln">count</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> u1</span><span class="pun">.</span><span class="pln">followed</span><span class="pun">.</span><span class="pln">first</span><span class="pun">().</span><span class="pln">nickname </span><span class="pun">==</span><span class="pln"> </span><span class="str">'susan'</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> u2</span><span class="pun">.</span><span class="pln">followers</span><span class="pun">.</span><span class="pln">count</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> u2</span><span class="pun">.</span><span class="pln">followers</span><span class="pun">.</span><span class="pln">first</span><span class="pun">().</span><span class="pln">nickname </span><span class="pun">==</span><span class="pln"> </span><span class="str">'john'</span><span class="pln">
        u </span><span class="pun">=</span><span class="pln"> u1</span><span class="pun">.</span><span class="pln">unfollow</span><span class="pun">(</span><span class="pln">u2</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> u </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">None</span><span class="pln">
        db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">u</span><span class="pun">)</span><span class="pln">
        db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">commit</span><span class="pun">()</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> u1</span><span class="pun">.</span><span class="pln">is_following</span><span class="pun">(</span><span class="pln">u2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">False</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> u1</span><span class="pun">.</span><span class="pln">followed</span><span class="pun">.</span><span class="pln">count</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> u2</span><span class="pun">.</span><span class="pln">followers</span><span class="pun">.</span><span class="pln">count</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span></code></pre>
<p>After adding this test to the testing framework we can run the entire test suite with the following command:</p>
<pre class="prettyprint"><code><span class="pun">./</span><span class="pln">tests</span><span class="pun">.</span><span class="pln">py</span></code></pre>
<p>And if everything works it should say that all our tests pass.</p>
<h2>Database queries</h2>
<p>Our current database model supports most of the requirements we 
listed at the start. The one we are missing is, in fact, the hardest. 
Our index page will show the posts written by all the people that are 
followed by the logged in user, so we need a query that returns all 
these posts.</p>
<p>The most obvious solution is to run a query that gives us the list of
 followed users, which we can already do. Then for each of these 
returned users we run a query to get the posts. Once we have all the 
posts we merge them into a single list and sort them by date. Sounds 
good? Well, not really. </p>
<p>This approach has a couple of problems. What happens if a user is 
following a thousand people? We need to execute a thousand database 
queries just to collect all the posts. And now we have the thousand 
lists in memory that we need to merge and sort. As a secondary problem, 
consider that our index page will (eventually) have pagination 
implemented, so we will not display all the available posts but just the
 first, say, fifty, with links to get the next or previous set of fifty.
 If we are going to display posts sorted by their date, how can we know 
which posts are the most recent fifty of all followed users combined, 
unless we get all the posts and sort them first? This is actually an 
awful solution that does not scale well.</p>
<p>While this collecting and sorting work needs to be done somehow, us 
doing it results in a very inefficient process. This kind of work is 
what relational databases excel at. The database has indexes that allow 
it to perform the queries and the sorting in a much more efficient way 
that we can possibly do from our side.</p>
<p>So what we really want is to come up with a single database query 
that expresses what information we want to get, and then we let the 
database figure out what is the most efficient way to obtain the data 
for us.</p>
<p>To end the mystery, here is the query that achieves this. 
Unfortunately it is yet another heavily loaded one liner that we will 
add to the <code>User</code> model (file <code>app/models.py</code>):</p>
<pre class="prettyprint"><code><span class="kwd">class</span><span class="pln"> </span><span class="typ">User</span><span class="pun">(</span><span class="pln">db</span><span class="pun">.</span><span class="typ">Model</span><span class="pun">):</span><span class="pln">
    </span><span class="com">#...</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> followed_posts</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">):</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Post</span><span class="pun">.</span><span class="pln">query</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="pln">followers</span><span class="pun">,</span><span class="pln"> </span><span class="pun">(</span><span class="pln">followers</span><span class="pun">.</span><span class="pln">c</span><span class="pun">.</span><span class="pln">followed_id </span><span class="pun">==</span><span class="pln"> </span><span class="typ">Post</span><span class="pun">.</span><span class="pln">user_id</span><span class="pun">)).</span><span class="pln">filter</span><span class="pun">(</span><span class="pln">followers</span><span class="pun">.</span><span class="pln">c</span><span class="pun">.</span><span class="pln">follower_id </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">id</span><span class="pun">).</span><span class="pln">order_by</span><span class="pun">(</span><span class="typ">Post</span><span class="pun">.</span><span class="pln">timestamp</span><span class="pun">.</span><span class="pln">desc</span><span class="pun">())</span></code></pre>
<p>Let's try to decipher this query one piece at a time. There are three parts: the <em>join</em>, the <em>filter</em> and the <em>order_by</em>.</p>
<h3>Joins</h3>
<p>To understand what a join operation does, let's look at an example. Let's assume we have a <code>User</code> table with the following contents:</p>
<table class="data">
<tbody><tr><th colspan="2">User</th></tr>
<tr><th>id</th><th>nickname</th></tr>
<tr><td>1</td><td>john</td></tr>
<tr><td>2</td><td>susan</td></tr>
<tr><td>3</td><td>mary</td></tr>
<tr><td>4</td><td>david</td></tr>
</tbody></table>

<p>There are some extra fields in the table that are not shown above just to simplify the example.</p>
<p>Let's say that our <code>followers</code> association table says that
 user "john" is following users "susan" and "david", user "susan" is 
following "mary" and user "mary" is following "david". The data that 
represents the above is this:</p>
<table class="data">
<tbody><tr><th colspan="2">followers</th></tr>
<tr><th>follower_id</th><th>followed_id</th></tr>
<tr><td>1</td><td>2</td></tr>
<tr><td>1</td><td>4</td></tr>
<tr><td>2</td><td>3</td></tr>
<tr><td>3</td><td>4</td></tr>
</tbody></table>

<p>And finally, our <code>Post</code> table contains one post from each user:</p>
<table class="data">
<tbody><tr><th colspan="3">Post</th></tr>
<tr><th>id</th><th>text</th><th>user_id</th></tr>
<tr><td>1</td><td>post from susan</td><td>2</td></tr>
<tr><td>2</td><td>post from mary</td><td>3</td></tr>
<tr><td>3</td><td>post from david</td><td>4</td></tr>
<tr><td>4</td><td>post from john</td><td>1</td></tr>
</tbody></table>

<p>Here again there are some fields that are omitted to keep the example simple.</p>
<p>Below is the join portion of our query, isolated from the rest of the query:</p>
<pre class="prettyprint"><code><span class="typ">Post</span><span class="pun">.</span><span class="pln">query</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="pln">followers</span><span class="pun">,</span><span class="pln"> 
    </span><span class="pun">(</span><span class="pln">followers</span><span class="pun">.</span><span class="pln">c</span><span class="pun">.</span><span class="pln">followed_id </span><span class="pun">==</span><span class="pln"> </span><span class="typ">Post</span><span class="pun">.</span><span class="pln">user_id</span><span class="pun">))</span></code></pre>
<p>The <code>join</code> operation is called on the <code>Post</code> table. There are two arguments, the first is another table, our <code>followers</code> table. The second argument to the join call is the join <em>condition</em>.</p>
<p>What the join operation will do with all this is create a temporary new table with data from the <code>Post</code> and <code>followers</code> table, merged according to the given condition.</p>
<p>In this example we want the field <code>followed_id</code> of the <code>followers</code> table to match the <code>user_id</code> field of the <code>Post</code> table.</p>
<p>To perform this merge, we take each record from the <code>Post</code> table (the left side of the join) and append the fields from the records in the <code>followers</code> table (the right side of the join) that match the condition. If there is no match, then that post record is removed.</p>
<p>The result of the join in our example results in this temporary table:</p>
<table class="data">
<tbody><tr><th colspan="3">Post</th><th colspan="2">followers</th></tr>
<tr><th>id</th><th>text</th><th>user_id</th><th>follower_id</th><th>followed_id</th></tr>
<tr><td>1</td><td>post from susan</td><td>2</td><td>1</td><td>2</td></tr>
<tr><td>2</td><td>post from mary</td><td>3</td><td>2</td><td>3</td></tr>
<tr><td>3</td><td>post from david</td><td>4</td><td>1</td><td>4</td></tr>
<tr><td>3</td><td>post from david</td><td>4</td><td>3</td><td>4</td></tr>
</tbody></table>

<p>Note how the post with user_id=1 was removed from the join, because there is no record in the <code>followers</code> table that has a followed_id=1. Also note how the post with user_id=4 appears twice, because the <code>followers</code> table has two entries with a followed_id=4.</p>
<h3>Filters</h3>
<p>The join operation gave us a list of posts that are followed by 
someone, without specifying who is the follower. We are only interested 
in a subset of this list, we need just the posts that are followed by 
one specific user.</p>
<p>So we will filter this table by the follower user. The filter portion of the query then is:</p>
<pre class="prettyprint"><code><span class="pln">filter</span><span class="pun">(</span><span class="pln">followers</span><span class="pun">.</span><span class="pln">c</span><span class="pun">.</span><span class="pln">follower_id </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">id</span><span class="pun">)</span></code></pre>
<p>Remember that the query is executed in the context of our target user, because it is a method in the User class, so <code>self.id</code>
 in this context is the id of the user we are interested in. With this 
filter we are telling the database that we want to keep just the records
 from the joined table that have our user as a follower. So following 
our example, if the user we are asking about is the one with id=1, then 
we would end up with yet another temporary table:</p>
<table class="data">
<tbody><tr><th colspan="3">Post</th><th colspan="2">followers</th></tr>
<tr><th>id</th><th>text</th><th>user_id</th><th>follower_id</th><th>followed_id</th></tr>
<tr><td>1</td><td>post from susan</td><td>2</td><td>1</td><td>2</td></tr>
<tr><td>3</td><td>post from david</td><td>4</td><td>1</td><td>4</td></tr>
</tbody></table>

<p>And these are exactly the posts that we want!</p>
<p>Remember that the query was issued on the Post class, so even though 
we ended up with a temporary table that does not match any of our 
models, the result will be the posts that are included in this temporary
 table, without the extra columns added by the join operation.</p>
<h3>Sorting</h3>
<p>The final step of the process is to sort the results according to our criteria. The portion of the query that does that says:</p>
<pre class="prettyprint"><code><span class="pln">order_by</span><span class="pun">(</span><span class="typ">Post</span><span class="pun">.</span><span class="pln">timestamp</span><span class="pun">.</span><span class="pln">desc</span><span class="pun">())</span></code></pre>
<p>Here we are saying that the results should be sorted by the timestamp
 field in descending order, so that the first result will be the most 
recent post.</p>
<p>There is only one more minor detail that we can add to improve our 
query. When users  read their followed posts they will probably want to 
see their own posts inserted in the stream as well, so it would be nice 
to have those included in the query results.</p>
<p>And turns out there is a very simple way to achieve this that doesn't
 require any changes! We will just make sure that each user is added as a
 follower of him/herself in the database, and that will take care of 
this little problem for us.</p>
<p>To conclude our long discussion on queries, let's write a unit test for our query (file <code>tests.py</code>):</p>
<pre class="prettyprint"><code><span class="com">#...</span><span class="pln">
</span><span class="kwd">from</span><span class="pln"> datetime </span><span class="kwd">import</span><span class="pln"> datetime</span><span class="pun">,</span><span class="pln"> timedelta
</span><span class="kwd">from</span><span class="pln"> app</span><span class="pun">.</span><span class="pln">models </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">User</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Post</span><span class="pln">
</span><span class="com">#...</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">TestCase</span><span class="pun">(</span><span class="pln">unittest</span><span class="pun">.</span><span class="typ">TestCase</span><span class="pun">):</span><span class="pln">
    </span><span class="com">#...</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> test_follow_posts</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">):</span><span class="pln">
        </span><span class="com"># make four users</span><span class="pln">
        u1 </span><span class="pun">=</span><span class="pln"> </span><span class="typ">User</span><span class="pun">(</span><span class="pln">nickname </span><span class="pun">=</span><span class="pln"> </span><span class="str">'john'</span><span class="pun">,</span><span class="pln"> email </span><span class="pun">=</span><span class="pln"> </span><span class="str">'john@example.com'</span><span class="pun">)</span><span class="pln">
        u2 </span><span class="pun">=</span><span class="pln"> </span><span class="typ">User</span><span class="pun">(</span><span class="pln">nickname </span><span class="pun">=</span><span class="pln"> </span><span class="str">'susan'</span><span class="pun">,</span><span class="pln"> email </span><span class="pun">=</span><span class="pln"> </span><span class="str">'susan@example.com'</span><span class="pun">)</span><span class="pln">
        u3 </span><span class="pun">=</span><span class="pln"> </span><span class="typ">User</span><span class="pun">(</span><span class="pln">nickname </span><span class="pun">=</span><span class="pln"> </span><span class="str">'mary'</span><span class="pun">,</span><span class="pln"> email </span><span class="pun">=</span><span class="pln"> </span><span class="str">'mary@example.com'</span><span class="pun">)</span><span class="pln">
        u4 </span><span class="pun">=</span><span class="pln"> </span><span class="typ">User</span><span class="pun">(</span><span class="pln">nickname </span><span class="pun">=</span><span class="pln"> </span><span class="str">'david'</span><span class="pun">,</span><span class="pln"> email </span><span class="pun">=</span><span class="pln"> </span><span class="str">'david@example.com'</span><span class="pun">)</span><span class="pln">
        db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">u1</span><span class="pun">)</span><span class="pln">
        db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">u2</span><span class="pun">)</span><span class="pln">
        db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">u3</span><span class="pun">)</span><span class="pln">
        db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">u4</span><span class="pun">)</span><span class="pln">
        </span><span class="com"># make four posts</span><span class="pln">
        utcnow </span><span class="pun">=</span><span class="pln"> datetime</span><span class="pun">.</span><span class="pln">utcnow</span><span class="pun">()</span><span class="pln">
        p1 </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Post</span><span class="pun">(</span><span class="pln">body </span><span class="pun">=</span><span class="pln"> </span><span class="str">"post from john"</span><span class="pun">,</span><span class="pln"> author </span><span class="pun">=</span><span class="pln"> u1</span><span class="pun">,</span><span class="pln"> timestamp </span><span class="pun">=</span><span class="pln"> utcnow </span><span class="pun">+</span><span class="pln"> timedelta</span><span class="pun">(</span><span class="pln">seconds </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">))</span><span class="pln">
        p2 </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Post</span><span class="pun">(</span><span class="pln">body </span><span class="pun">=</span><span class="pln"> </span><span class="str">"post from susan"</span><span class="pun">,</span><span class="pln"> author </span><span class="pun">=</span><span class="pln"> u2</span><span class="pun">,</span><span class="pln"> timestamp </span><span class="pun">=</span><span class="pln"> utcnow </span><span class="pun">+</span><span class="pln"> timedelta</span><span class="pun">(</span><span class="pln">seconds </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">))</span><span class="pln">
        p3 </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Post</span><span class="pun">(</span><span class="pln">body </span><span class="pun">=</span><span class="pln"> </span><span class="str">"post from mary"</span><span class="pun">,</span><span class="pln"> author </span><span class="pun">=</span><span class="pln"> u3</span><span class="pun">,</span><span class="pln"> timestamp </span><span class="pun">=</span><span class="pln"> utcnow </span><span class="pun">+</span><span class="pln"> timedelta</span><span class="pun">(</span><span class="pln">seconds </span><span class="pun">=</span><span class="pln"> </span><span class="lit">3</span><span class="pun">))</span><span class="pln">
        p4 </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Post</span><span class="pun">(</span><span class="pln">body </span><span class="pun">=</span><span class="pln"> </span><span class="str">"post from david"</span><span class="pun">,</span><span class="pln"> author </span><span class="pun">=</span><span class="pln"> u4</span><span class="pun">,</span><span class="pln"> timestamp </span><span class="pun">=</span><span class="pln"> utcnow </span><span class="pun">+</span><span class="pln"> timedelta</span><span class="pun">(</span><span class="pln">seconds </span><span class="pun">=</span><span class="pln"> </span><span class="lit">4</span><span class="pun">))</span><span class="pln">
        db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">p1</span><span class="pun">)</span><span class="pln">
        db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">p2</span><span class="pun">)</span><span class="pln">
        db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">p3</span><span class="pun">)</span><span class="pln">
        db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">p4</span><span class="pun">)</span><span class="pln">
        db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">commit</span><span class="pun">()</span><span class="pln">
        </span><span class="com"># setup the followers</span><span class="pln">
        u1</span><span class="pun">.</span><span class="pln">follow</span><span class="pun">(</span><span class="pln">u1</span><span class="pun">)</span><span class="pln"> </span><span class="com"># john follows himself</span><span class="pln">
        u1</span><span class="pun">.</span><span class="pln">follow</span><span class="pun">(</span><span class="pln">u2</span><span class="pun">)</span><span class="pln"> </span><span class="com"># john follows susan</span><span class="pln">
        u1</span><span class="pun">.</span><span class="pln">follow</span><span class="pun">(</span><span class="pln">u4</span><span class="pun">)</span><span class="pln"> </span><span class="com"># john follows david</span><span class="pln">
        u2</span><span class="pun">.</span><span class="pln">follow</span><span class="pun">(</span><span class="pln">u2</span><span class="pun">)</span><span class="pln"> </span><span class="com"># susan follows herself</span><span class="pln">
        u2</span><span class="pun">.</span><span class="pln">follow</span><span class="pun">(</span><span class="pln">u3</span><span class="pun">)</span><span class="pln"> </span><span class="com"># susan follows mary</span><span class="pln">
        u3</span><span class="pun">.</span><span class="pln">follow</span><span class="pun">(</span><span class="pln">u3</span><span class="pun">)</span><span class="pln"> </span><span class="com"># mary follows herself</span><span class="pln">
        u3</span><span class="pun">.</span><span class="pln">follow</span><span class="pun">(</span><span class="pln">u4</span><span class="pun">)</span><span class="pln"> </span><span class="com"># mary follows david</span><span class="pln">
        u4</span><span class="pun">.</span><span class="pln">follow</span><span class="pun">(</span><span class="pln">u4</span><span class="pun">)</span><span class="pln"> </span><span class="com"># david follows himself</span><span class="pln">
        db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">u1</span><span class="pun">)</span><span class="pln">
        db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">u2</span><span class="pun">)</span><span class="pln">
        db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">u3</span><span class="pun">)</span><span class="pln">
        db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">u4</span><span class="pun">)</span><span class="pln">
        db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">commit</span><span class="pun">()</span><span class="pln">
        </span><span class="com"># check the followed posts of each user</span><span class="pln">
        f1 </span><span class="pun">=</span><span class="pln"> u1</span><span class="pun">.</span><span class="pln">followed_posts</span><span class="pun">().</span><span class="pln">all</span><span class="pun">()</span><span class="pln">
        f2 </span><span class="pun">=</span><span class="pln"> u2</span><span class="pun">.</span><span class="pln">followed_posts</span><span class="pun">().</span><span class="pln">all</span><span class="pun">()</span><span class="pln">
        f3 </span><span class="pun">=</span><span class="pln"> u3</span><span class="pun">.</span><span class="pln">followed_posts</span><span class="pun">().</span><span class="pln">all</span><span class="pun">()</span><span class="pln">
        f4 </span><span class="pun">=</span><span class="pln"> u4</span><span class="pun">.</span><span class="pln">followed_posts</span><span class="pun">().</span><span class="pln">all</span><span class="pun">()</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> len</span><span class="pun">(</span><span class="pln">f1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> len</span><span class="pun">(</span><span class="pln">f2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> len</span><span class="pun">(</span><span class="pln">f3</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> len</span><span class="pun">(</span><span class="pln">f4</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> f1 </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="pln">p4</span><span class="pun">,</span><span class="pln"> p2</span><span class="pun">,</span><span class="pln"> p1</span><span class="pun">]</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> f2 </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="pln">p3</span><span class="pun">,</span><span class="pln"> p2</span><span class="pun">]</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> f3 </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="pln">p4</span><span class="pun">,</span><span class="pln"> p3</span><span class="pun">]</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> f4 </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="pln">p4</span><span class="pun">]</span></code></pre>
<p>This test has a lot of setup code but the actual test is pretty 
short. We first check that the number of followed posts returned for 
each user is the expected one. Then for each user we check that the 
correct posts were returned and that they came in the correct order 
(note that we inserted the posts with timestamps that are guaranteed to 
always order in the same way).</p>
<p>Note the usage of the <code>followed_posts()</code> method. This method returns a query object, not the results. This is similar to how relationships with <code>lazy = 'dynamic'</code>
 work. It is always a good idea to return query objects instead of 
results, because that gives the caller the choice of adding more clauses
 to the query before it is executed.</p>
<p>There are several methods in the query object that trigger the query execution. We've seen that <code>count()</code> runs the query and returns the number of results (throwing the actual results away). We have also used <code>first()</code> to return the first result and throw away the rest, if any. In this test we are using the <code>all()</code> method to get an array with all the results.</p>
<h2>Possible improvements</h2>
<p>We now have implemented all the required features of our 'follower' 
feature, but there are ways to improve our design and make it more 
flexible.</p>
<p>All the social networks that we love to hate support similar ways to 
connect users, but they have more options to control the sharing of 
information.</p>
<p>For example, we have not elected to support the ability to block 
users. This would add one more layer of complexity to our queries, since
 now we not only need to grab the posts of the users we follow, but we 
need to filter out those from users that decided to block us. How would 
you implement this? Simple, one more many-to-many self-referential 
relationship to record who's blocking who, and one more join+filter in 
the query that returns the followed posts.</p>
<p>Another popular feature in social networks is the ability to group 
followers into custom lists, and then sharing content only with specific
 groups. This is also implemented with additional relationships and 
added complexity to the queries.</p>
<p>We will not have these features in <code>microblog</code>, but if there is enough interest I would be happy to write an article on the topic. Let me know in the comments!</p>
<h2>Tying up loose ends</h2>
<p>We have made an impressive amount of progress today. But while we 
have solved all the problems related to database setup and querying, we 
have not enabled the new functionality through our application.</p>
<p>Luckily for us, there aren't any challenges in doing this. We just 
need to fix view functions and templates to call the new methods in the <code>User</code> model when appropriate. So let's do that before we close this session.</p>
<h3>Being your own follower</h3>
<p>We decided that we were going to mark all users as followers of 
themselves, so that they can see their own posts in their post stream.</p>
<p>We are going to do that at the point where users are getting their accounts setup, in the <code>after_login</code> handler for OpenID (file 'app/views.py'):</p>
<pre class="prettyprint"><code><span class="lit">@oid</span><span class="pun">.</span><span class="pln">after_login
</span><span class="kwd">def</span><span class="pln"> after_login</span><span class="pun">(</span><span class="pln">resp</span><span class="pun">):</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> resp</span><span class="pun">.</span><span class="pln">email </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">None</span><span class="pln"> </span><span class="kwd">or</span><span class="pln"> resp</span><span class="pun">.</span><span class="pln">email </span><span class="pun">==</span><span class="pln"> </span><span class="str">""</span><span class="pun">:</span><span class="pln">
        flash</span><span class="pun">(</span><span class="str">'Invalid login. Please try again.'</span><span class="pun">)</span><span class="pln">
        redirect</span><span class="pun">(</span><span class="pln">url_for</span><span class="pun">(</span><span class="str">'login'</span><span class="pun">))</span><span class="pln">
    user </span><span class="pun">=</span><span class="pln"> </span><span class="typ">User</span><span class="pun">.</span><span class="pln">query</span><span class="pun">.</span><span class="pln">filter_by</span><span class="pun">(</span><span class="pln">email </span><span class="pun">=</span><span class="pln"> resp</span><span class="pun">.</span><span class="pln">email</span><span class="pun">).</span><span class="pln">first</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> user </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">None</span><span class="pun">:</span><span class="pln">
        nickname </span><span class="pun">=</span><span class="pln"> resp</span><span class="pun">.</span><span class="pln">nickname
        </span><span class="kwd">if</span><span class="pln"> nickname </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">None</span><span class="pln"> </span><span class="kwd">or</span><span class="pln"> nickname </span><span class="pun">==</span><span class="pln"> </span><span class="str">""</span><span class="pun">:</span><span class="pln">
            nickname </span><span class="pun">=</span><span class="pln"> resp</span><span class="pun">.</span><span class="pln">email</span><span class="pun">.</span><span class="pln">split</span><span class="pun">(</span><span class="str">'@'</span><span class="pun">)[</span><span class="lit">0</span><span class="pun">]</span><span class="pln">
        nickname </span><span class="pun">=</span><span class="pln"> </span><span class="typ">User</span><span class="pun">.</span><span class="pln">make_unique_nickname</span><span class="pun">(</span><span class="pln">nickname</span><span class="pun">)</span><span class="pln">
        user </span><span class="pun">=</span><span class="pln"> </span><span class="typ">User</span><span class="pun">(</span><span class="pln">nickname </span><span class="pun">=</span><span class="pln"> nickname</span><span class="pun">,</span><span class="pln"> email </span><span class="pun">=</span><span class="pln"> resp</span><span class="pun">.</span><span class="pln">email</span><span class="pun">,</span><span class="pln"> role </span><span class="pun">=</span><span class="pln"> ROLE_USER</span><span class="pun">)</span><span class="pln">
        db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">user</span><span class="pun">)</span><span class="pln">
        db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">commit</span><span class="pun">()</span><span class="pln">
        </span><span class="com"># make the user follow him/herself</span><span class="pln">
        db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">user</span><span class="pun">.</span><span class="pln">follow</span><span class="pun">(</span><span class="pln">user</span><span class="pun">))</span><span class="pln">
        db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">commit</span><span class="pun">()</span><span class="pln">
    remember_me </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">False</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="str">'remember_me'</span><span class="pln"> </span><span class="kwd">in</span><span class="pln"> session</span><span class="pun">:</span><span class="pln">
        remember_me </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">[</span><span class="str">'remember_me'</span><span class="pun">]</span><span class="pln">
        session</span><span class="pun">.</span><span class="pln">pop</span><span class="pun">(</span><span class="str">'remember_me'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">None</span><span class="pun">)</span><span class="pln">
    login_user</span><span class="pun">(</span><span class="pln">user</span><span class="pun">,</span><span class="pln"> remember </span><span class="pun">=</span><span class="pln"> remember_me</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> redirect</span><span class="pun">(</span><span class="pln">request</span><span class="pun">.</span><span class="pln">args</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'next'</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">or</span><span class="pln"> url_for</span><span class="pun">(</span><span class="str">'index'</span><span class="pun">))</span></code></pre>
<h3>Follow and Unfollow links</h3>
<p>Next, we will define view functions that follow and unfollow a user (file <code>app/views.py</code>):</p>
<pre class="prettyprint"><code><span class="lit">@app</span><span class="pun">.</span><span class="pln">route</span><span class="pun">(</span><span class="str">'/follow/&lt;nickname&gt;'</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@login_required</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> follow</span><span class="pun">(</span><span class="pln">nickname</span><span class="pun">):</span><span class="pln">
    user </span><span class="pun">=</span><span class="pln"> </span><span class="typ">User</span><span class="pun">.</span><span class="pln">query</span><span class="pun">.</span><span class="pln">filter_by</span><span class="pun">(</span><span class="pln">nickname </span><span class="pun">=</span><span class="pln"> nickname</span><span class="pun">).</span><span class="pln">first</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> user </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">None</span><span class="pun">:</span><span class="pln">
        flash</span><span class="pun">(</span><span class="str">'User '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> nickname </span><span class="pun">+</span><span class="pln"> </span><span class="str">' not found.'</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> redirect</span><span class="pun">(</span><span class="pln">url_for</span><span class="pun">(</span><span class="str">'index'</span><span class="pun">))</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> user </span><span class="pun">==</span><span class="pln"> g</span><span class="pun">.</span><span class="pln">user</span><span class="pun">:</span><span class="pln">
        flash</span><span class="pun">(</span><span class="str">'You can\'t follow yourself!'</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> redirect</span><span class="pun">(</span><span class="pln">url_for</span><span class="pun">(</span><span class="str">'user'</span><span class="pun">,</span><span class="pln"> nickname </span><span class="pun">=</span><span class="pln"> nickname</span><span class="pun">))</span><span class="pln">
    u </span><span class="pun">=</span><span class="pln"> g</span><span class="pun">.</span><span class="pln">user</span><span class="pun">.</span><span class="pln">follow</span><span class="pun">(</span><span class="pln">user</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> u </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">None</span><span class="pun">:</span><span class="pln">
        flash</span><span class="pun">(</span><span class="str">'Cannot follow '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> nickname </span><span class="pun">+</span><span class="pln"> </span><span class="str">'.'</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> redirect</span><span class="pun">(</span><span class="pln">url_for</span><span class="pun">(</span><span class="str">'user'</span><span class="pun">,</span><span class="pln"> nickname </span><span class="pun">=</span><span class="pln"> nickname</span><span class="pun">))</span><span class="pln">
    db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">u</span><span class="pun">)</span><span class="pln">
    db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">commit</span><span class="pun">()</span><span class="pln">
    flash</span><span class="pun">(</span><span class="str">'You are now following '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> nickname </span><span class="pun">+</span><span class="pln"> </span><span class="str">'!'</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> redirect</span><span class="pun">(</span><span class="pln">url_for</span><span class="pun">(</span><span class="str">'user'</span><span class="pun">,</span><span class="pln"> nickname </span><span class="pun">=</span><span class="pln"> nickname</span><span class="pun">))</span><span class="pln">

</span><span class="lit">@app</span><span class="pun">.</span><span class="pln">route</span><span class="pun">(</span><span class="str">'/unfollow/&lt;nickname&gt;'</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@login_required</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> unfollow</span><span class="pun">(</span><span class="pln">nickname</span><span class="pun">):</span><span class="pln">
    user </span><span class="pun">=</span><span class="pln"> </span><span class="typ">User</span><span class="pun">.</span><span class="pln">query</span><span class="pun">.</span><span class="pln">filter_by</span><span class="pun">(</span><span class="pln">nickname </span><span class="pun">=</span><span class="pln"> nickname</span><span class="pun">).</span><span class="pln">first</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> user </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">None</span><span class="pun">:</span><span class="pln">
        flash</span><span class="pun">(</span><span class="str">'User '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> nickname </span><span class="pun">+</span><span class="pln"> </span><span class="str">' not found.'</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> redirect</span><span class="pun">(</span><span class="pln">url_for</span><span class="pun">(</span><span class="str">'index'</span><span class="pun">))</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> user </span><span class="pun">==</span><span class="pln"> g</span><span class="pun">.</span><span class="pln">user</span><span class="pun">:</span><span class="pln">
        flash</span><span class="pun">(</span><span class="str">'You can\'t unfollow yourself!'</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> redirect</span><span class="pun">(</span><span class="pln">url_for</span><span class="pun">(</span><span class="str">'user'</span><span class="pun">,</span><span class="pln"> nickname </span><span class="pun">=</span><span class="pln"> nickname</span><span class="pun">))</span><span class="pln">
    u </span><span class="pun">=</span><span class="pln"> g</span><span class="pun">.</span><span class="pln">user</span><span class="pun">.</span><span class="pln">unfollow</span><span class="pun">(</span><span class="pln">user</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> u </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">None</span><span class="pun">:</span><span class="pln">
        flash</span><span class="pun">(</span><span class="str">'Cannot unfollow '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> nickname </span><span class="pun">+</span><span class="pln"> </span><span class="str">'.'</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> redirect</span><span class="pun">(</span><span class="pln">url_for</span><span class="pun">(</span><span class="str">'user'</span><span class="pun">,</span><span class="pln"> nickname </span><span class="pun">=</span><span class="pln"> nickname</span><span class="pun">))</span><span class="pln">
    db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">u</span><span class="pun">)</span><span class="pln">
    db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">commit</span><span class="pun">()</span><span class="pln">
    flash</span><span class="pun">(</span><span class="str">'You have stopped following '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> nickname </span><span class="pun">+</span><span class="pln"> </span><span class="str">'.'</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> redirect</span><span class="pun">(</span><span class="pln">url_for</span><span class="pun">(</span><span class="str">'user'</span><span class="pun">,</span><span class="pln"> nickname </span><span class="pun">=</span><span class="pln"> nickname</span><span class="pun">))</span></code></pre>
<p>These should be self-explanatory, but note how there is error 
checking all around, to prevent unexpected problems and try to provide a
 message to the user and a redirection when a problem has occurred.</p>
<p>Now we have the view functions, so we can hook them up. The links to 
follow and unfollow a user will appear in the profile page of each user 
(file <code>app/templates/user.html</code>):</p>
<pre class="prettyprint"><code><span class="com">&lt;!-- extend base layout --&gt;</span><span class="pln">
{% extends "base.html" %}

{% block content %}
</span><span class="tag">&lt;table&gt;</span><span class="pln">
    </span><span class="tag">&lt;tr</span><span class="pln"> </span><span class="atn">valign</span><span class="pun">=</span><span class="atv">"top"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;td&gt;&lt;img</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"{{user.avatar(128)}}"</span><span class="tag">&gt;&lt;/td&gt;</span><span class="pln">
        </span><span class="tag">&lt;td&gt;</span><span class="pln">
            </span><span class="tag">&lt;h1&gt;</span><span class="pln">User: {{user.nickname}}</span><span class="tag">&lt;/h1&gt;</span><span class="pln">
            {% if user.about_me %}</span><span class="tag">&lt;p&gt;</span><span class="pln">{{user.about_me}}</span><span class="tag">&lt;/p&gt;</span><span class="pln">{% endif %}
            {% if user.last_seen %}</span><span class="tag">&lt;p&gt;&lt;i&gt;</span><span class="pln">Last seen on: {{user.last_seen}}</span><span class="tag">&lt;/i&gt;&lt;/p&gt;</span><span class="pln">{% endif %}
            </span><span class="tag">&lt;p&gt;</span><span class="pln">{{user.followers.count()}} followers | 
            {% if user.id == g.user.id %}
                </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{url_for('edit')}}"</span><span class="tag">&gt;</span><span class="pln">Edit your profile</span><span class="tag">&lt;/a&gt;</span><span class="pln">
            {% elif not g.user.is_following(user) %}
                </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{url_for('follow', nickname = user.nickname)}}"</span><span class="tag">&gt;</span><span class="pln">Follow</span><span class="tag">&lt;/a&gt;</span><span class="pln">
            {% else %}
                </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{url_for('unfollow', nickname = user.nickname)}}"</span><span class="tag">&gt;</span><span class="pln">Unfollow</span><span class="tag">&lt;/a&gt;</span><span class="pln">
            {% endif %}
            </span><span class="tag">&lt;/p&gt;</span><span class="pln">
        </span><span class="tag">&lt;/td&gt;</span><span class="pln">
    </span><span class="tag">&lt;/tr&gt;</span><span class="pln">
</span><span class="tag">&lt;/table&gt;</span><span class="pln">
</span><span class="tag">&lt;hr&gt;</span><span class="pln">
{% for post in posts %}
    {% include 'post.html' %}
{% endfor %}
{% endblock %}</span></code></pre>
<p>In the line we had the "Edit" link we now show the number of followers the user has, followed by one of three possible links:</p>
<ul>
<li>if the user profile belongs to the logged in user, then the "Edit" link shows.</li>
<li>else, if the user is not currently followed a "Follow" link shows.</li>
<li>else, a "Unfollow" link shows.</li>
</ul>
<p>At this point you can run the application, create a few users by 
logging in with different OpenID accounts and play with following and 
unfollowing users.</p>
<p>All that is left is to show posts of the followed users in the <code>index</code>
 page, but we are still missing an important piece of the puzzle before 
we can do that, so this will have to wait until the next chapter.</p>
<h2>Final words</h2>
<p>We have implemented a core piece of our application today. The topic 
of database relationships and queries is a pretty complex one, so if 
there are any questions about the material presented above you are 
welcome to send your questions in the comments below.</p>
<p>In the next installment we will be looking at the fascinating world 
of pagination, and we will be finally hooking up posts from the database
 to our application.</p>
<p>For those of you that are lazy typists (or lazy copy-pasters), below is the updated <code>microblog</code> application:</p>
<p>Download <a href="https://github.com/miguelgrinberg/microblog/archive/v0.8.zip">microblog-0.8.zip</a>.</p>
<p>As always, the above zip file does not include a database or the 
flask virtual environment. Previous articles explain how to regenerate 
these.</p>
<p>Thanks again for following my tutorial. See you next time!</p>
<p>Miguel</p></div>
<div class="social-mini"><table><tbody><tr>
    <td><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-viii-followers-contacts-and-friends" data-via="miguelgrinberg" data-count="none">Tweet</a></td>
    <td><g:plusone href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-viii-followers-contacts-and-friends" size="medium" witdh="100" annotation="none"></g:plusone></td>
    <td><script type="IN/Share" data-url="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-viii-followers-contacts-and-friends"></script></td>
    <td><div style="display: block;" class="fb-like" data-href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-viii-followers-contacts-and-friends" data-send="false" data-layout="button_count" data-width="100" data-show-faces="false" data-font="verdana"><iframe style="width: 30px; height: 19px; border: 0px none;" id="ujpcwulspqigctbbtntyipbdcefeartryzpzr"></iframe></div></td>
</tr></tbody></table></div>

<h4 style="text-align: right"><a name="comments"></a>55 comments</h4>


<div class="comment">
    <ul>
        
        <li>
            <div class="comment-thumbnail"></div>
            <div class="comment-body">
                <p>
                    <span class="label">#1</span> <span class="label label-info">Matt</span> said
                    <script type="text/javascript">
                    document.write(moment("2012-09-19T03:14:12Z").fromNow());
                    </script>a year ago:
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">This tutorial has really helped a lot, thanks!</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"></div>
            <div class="comment-body">
                <p>
                    <span class="label">#2</span> <span class="label label-info">sh4k</span> said
                    <script type="text/javascript">
                    document.write(moment("2012-09-20T16:23:19Z").fromNow());
                    </script>a year ago:
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">This is a great tutorial series. Keep up the great work. :)</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"></div>
            <div class="comment-body">
                <p>
                    <span class="label">#3</span> <span class="label label-info">Siros</span> said
                    <script type="text/javascript">
                    document.write(moment("2012-10-08T11:20:03Z").fromNow());
                    </script>a year ago:
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Thank you so much , i love the relational database design part.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"></div>
            <div class="comment-body">
                <p>
                    <span class="label">#4</span> <span class="label label-info">drew</span> said
                    <script type="text/javascript">
                    document.write(moment("2012-12-28T19:40:36Z").fromNow());
                    </script>a year ago:
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Is the primaryjoin
 and Secondary join are necessary because otherwise its ambiguous which 
type of User (follwer/followed) were referring to?</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"></div>
            <div class="comment-body">
                <p>
                    <span class="label">#5</span> <span class="label label-important">Miguel Grinberg</span> said
                    <script type="text/javascript">
                    document.write(moment("2012-12-31T17:49:25Z").fromNow());
                    </script>a year ago:
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@drew: yes, since 
the association table maps users to users, there is no way for the 
framework to figure out which users are followers and which are 
followed. The primary/secondary joins establish the proper links so that
 you have follower on the left side of the link and followed on the 
right.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"></div>
            <div class="comment-body">
                <p>
                    <span class="label">#6</span> <span class="label label-info">Tian Siyuan</span> said
                    <script type="text/javascript">
                    document.write(moment("2013-02-06T08:06:47Z").fromNow());
                    </script>a year ago:
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Hi Miguel,

It took me a while to figure out that:

After adding the follow oneself function, it does not work for users in the database; it works for new users.

Cheers,

Tian</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"></div>
            <div class="comment-body">
                <p>
                    <span class="label">#7</span> <span class="label label-info">Dogukan Tufekci</span> said
                    <script type="text/javascript">
                    document.write(moment("2013-02-07T18:00:23Z").fromNow());
                    </script>a year ago:
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@Miguel this 
mega-tutorial has been priceless for me to see a lot of different 
aspects of not only Flask but also Python. I can't thank you enough. 

You stated above: "For example, we have not elected to support the 
ability to block users. This would add one more layer of complexity to 
our queries, since now we not only need to grab the posts of the users 
we follow, but we need to filter out those from users that decided to 
block us. How would you implement this? Simple, one more many-to-many 
self-referential relationship to record who's blocking who, and one more
 join+filter in the query that returns the followed posts."

I would be very interested in seeing how you code the block feature. 
Thanks for all your efforts! Please attach a 'donate' button so we can 
at least buy you a coffee.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/729e26a2a2c7ff24a71958d4aa4e5f35.jpg"></div>
            <div class="comment-body">
                <p>
                    <span class="label">#8</span> <span class="label label-important">Miguel Grinberg</span> said
                    <script type="text/javascript">
                    document.write(moment("2013-02-08T06:22:27Z").fromNow());
                    </script>a year ago:
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@Dogukan: Thanks. 
The implementation of user blocks is pretty much identical to that of 
followers. You need to add another auxiliary table like the 'followers' 
table, let's call it 'blocks', to support one more many-to-many 
relationship from users to other users. The table will have two fields, 
blocker_id and blocked_id, same as with the followers. The final query 
to get all the followers minus the blocked ones will look something like
 this: Post.query.join(followers, (followers.c.followed_id == 
Post.user_id)).outerjoin(blocks, (blocks.c.blocker_id == 
Post.user_id)).filter(followers.c.follower_id == 
self.id).filter(blocks.c.blocked_id != 
self.id).filter(blocks.c.blocked_id != 
self.id).order_by(Post.timestamp.desc()).</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/729e26a2a2c7ff24a71958d4aa4e5f35.jpg"></div>
            <div class="comment-body">
                <p>
                    <span class="label">#9</span> <span class="label label-important">Miguel Grinberg</span> said
                    <script type="text/javascript">
                    document.write(moment("2013-02-08T06:24:36Z").fromNow());
                    </script>a year ago:
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">(continued) note 
that in this enhanced query there is an extra join that merges the 
blocks table (really an outerjoin which also matches entries in the left
 table that don't have any hits on the right table, which is necessary 
to not lose any posts from users that have no blocks). Then there is an 
extra filter to only choose the posts that are not blocked.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"></div>
            <div class="comment-body">
                <p>
                    <span class="label">#10</span> <span class="label label-info">sh4nks</span> said
                    <script type="text/javascript">
                    document.write(moment("2013-02-17T22:32:08Z").fromNow());
                    </script>a year ago:
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Hey Miguel!
Thanks for your great tutorial!
I still don't get it from where the "c" is? (in e.q. 
followers.**c**.follower_id ). It would be nice if you can explain that 
to me :)</p>
                </div>
            </div>
        </li>
        
    </ul>
    <!--
    <table width="100%">
    
    <tr>
        <td width="60px"><img src="http://gravatar.com/avatar/1701489242e4ac7f6f85dfc12ab8b7c8?s=60&d=identicon" /></td>
        <td>
            <p>
                <span class="label">#1</span> <span class="label label-info">Matt</span> said
                <script type="text/javascript">
                document.write(moment("2012-09-19T03:14:12Z").fromNow());
                </script>:
            </p>
            <div style="overflow: auto;">
                <p style="white-space: pre-wrap;">This tutorial has really helped a lot, thanks!aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</p>
            </div>
        </td>
    </tr>
    
    <tr>
        <td width="60px"><img src="http://gravatar.com/avatar/e8fd9bde8da5c9489e67771b4aab7caa?s=60&d=identicon" /></td>
        <td>
            <p>
                <span class="label">#2</span> <span class="label label-info">sh4k</span> said
                <script type="text/javascript">
                document.write(moment("2012-09-20T16:23:19Z").fromNow());
                </script>:
            </p>
            <div style="overflow: auto;">
                <p style="white-space: pre-wrap;">This is a great tutorial series. Keep up the great work. :)aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</p>
            </div>
        </td>
    </tr>
    
    <tr>
        <td width="60px"><img src="http://gravatar.com/avatar/110b30a978c33ff4802bc119b47a1122?s=60&d=identicon" /></td>
        <td>
            <p>
                <span class="label">#3</span> <span class="label label-info">Siros</span> said
                <script type="text/javascript">
                document.write(moment("2012-10-08T11:20:03Z").fromNow());
                </script>:
            </p>
            <div style="overflow: auto;">
                <p style="white-space: pre-wrap;">Thank you so much , i love the relational database design part.aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</p>
            </div>
        </td>
    </tr>
    
    <tr>
        <td width="60px"><img src="http://gravatar.com/avatar/8d7dd06bd18b8fce6a4c04dfede7f616?s=60&d=identicon" /></td>
        <td>
            <p>
                <span class="label">#4</span> <span class="label label-info">drew</span> said
                <script type="text/javascript">
                document.write(moment("2012-12-28T19:40:36Z").fromNow());
                </script>:
            </p>
            <div style="overflow: auto;">
                <p style="white-space: pre-wrap;">Is the primaryjoin and Secondary join are necessary because otherwise its ambiguous which type of User (follwer/followed) were referring to?aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</p>
            </div>
        </td>
    </tr>
    
    <tr>
        <td width="60px"><img src="http://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&d=identicon" /></td>
        <td>
            <p>
                <span class="label">#5</span> <span class="label label-important">Miguel Grinberg</span> said
                <script type="text/javascript">
                document.write(moment("2012-12-31T17:49:25Z").fromNow());
                </script>:
            </p>
            <div style="overflow: auto;">
                <p style="white-space: pre-wrap;">@drew: yes, since the association table maps users to users, there is no way for the framework to figure out which users are followers and which are followed. The primary/secondary joins establish the proper links so that you have follower on the left side of the link and followed on the right.aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</p>
            </div>
        </td>
    </tr>
    
    <tr>
        <td width="60px"><img src="http://gravatar.com/avatar/6e5f833944a27be2f84427a88e299c0c?s=60&d=identicon" /></td>
        <td>
            <p>
                <span class="label">#6</span> <span class="label label-info">Tian Siyuan</span> said
                <script type="text/javascript">
                document.write(moment("2013-02-06T08:06:47Z").fromNow());
                </script>:
            </p>
            <div style="overflow: auto;">
                <p style="white-space: pre-wrap;">Hi Miguel,

It took me a while to figure out that:

After adding the follow oneself function, it does not work for users in the database; it works for new users.

Cheers,

Tianaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</p>
            </div>
        </td>
    </tr>
    
    <tr>
        <td width="60px"><img src="http://gravatar.com/avatar/bafafefac4abe76b1218317d841e167b?s=60&d=identicon" /></td>
        <td>
            <p>
                <span class="label">#7</span> <span class="label label-info">Dogukan Tufekci</span> said
                <script type="text/javascript">
                document.write(moment("2013-02-07T18:00:23Z").fromNow());
                </script>:
            </p>
            <div style="overflow: auto;">
                <p style="white-space: pre-wrap;">@Miguel this mega-tutorial has been priceless for me to see a lot of different aspects of not only Flask but also Python. I can&#39;t thank you enough. 

You stated above: &#34;For example, we have not elected to support the ability to block users. This would add one more layer of complexity to our queries, since now we not only need to grab the posts of the users we follow, but we need to filter out those from users that decided to block us. How would you implement this? Simple, one more many-to-many self-referential relationship to record who&#39;s blocking who, and one more join+filter in the query that returns the followed posts.&#34;

I would be very interested in seeing how you code the block feature. Thanks for all your efforts! Please attach a &#39;donate&#39; button so we can at least buy you a coffee.aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</p>
            </div>
        </td>
    </tr>
    
    <tr>
        <td width="60px"><img src="http://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&d=identicon" /></td>
        <td>
            <p>
                <span class="label">#8</span> <span class="label label-important">Miguel Grinberg</span> said
                <script type="text/javascript">
                document.write(moment("2013-02-08T06:22:27Z").fromNow());
                </script>:
            </p>
            <div style="overflow: auto;">
                <p style="white-space: pre-wrap;">@Dogukan: Thanks. The implementation of user blocks is pretty much identical to that of followers. You need to add another auxiliary table like the &#39;followers&#39; table, let&#39;s call it &#39;blocks&#39;, to support one more many-to-many relationship from users to other users. The table will have two fields, blocker_id and blocked_id, same as with the followers. The final query to get all the followers minus the blocked ones will look something like this: Post.query.join(followers, (followers.c.followed_id == Post.user_id)).outerjoin(blocks, (blocks.c.blocker_id == Post.user_id)).filter(followers.c.follower_id == self.id).filter(blocks.c.blocked_id != self.id).filter(blocks.c.blocked_id != self.id).order_by(Post.timestamp.desc()).aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</p>
            </div>
        </td>
    </tr>
    
    <tr>
        <td width="60px"><img src="http://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&d=identicon" /></td>
        <td>
            <p>
                <span class="label">#9</span> <span class="label label-important">Miguel Grinberg</span> said
                <script type="text/javascript">
                document.write(moment("2013-02-08T06:24:36Z").fromNow());
                </script>:
            </p>
            <div style="overflow: auto;">
                <p style="white-space: pre-wrap;">(continued) note that in this enhanced query there is an extra join that merges the blocks table (really an outerjoin which also matches entries in the left table that don&#39;t have any hits on the right table, which is necessary to not lose any posts from users that have no blocks). Then there is an extra filter to only choose the posts that are not blocked.aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</p>
            </div>
        </td>
    </tr>
    
    <tr>
        <td width="60px"><img src="http://gravatar.com/avatar/995d242b7f21e0bb4e5be6af30ffd155?s=60&d=identicon" /></td>
        <td>
            <p>
                <span class="label">#10</span> <span class="label label-info">sh4nks</span> said
                <script type="text/javascript">
                document.write(moment("2013-02-17T22:32:08Z").fromNow());
                </script>:
            </p>
            <div style="overflow: auto;">
                <p style="white-space: pre-wrap;">Hey Miguel!
Thanks for your great tutorial!
I still don&#39;t get it from where the &#34;c&#34; is? (in e.q. followers.**c**.follower_id ). It would be nice if you can explain that to me :)aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</p>
            </div>
        </td>
    </tr>
    
    </table>
    -->
</div>

<div class="page">
<ul class="pager">
  <li class="previous disabled">
    <a href="#">««</a>
  </li>
  <li class="previous disabled">
    <a href="#">«</a>
  </li>
  <li class="next">
    <a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-viii-followers-contacts-and-friends/page/0#comments">»»</a>
  </li>
  <li class="next">
    <a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-viii-followers-contacts-and-friends/page/2#comments">»</a>
  </li>
</ul>
</div>

<h3><a name="commentform"></a>Leave a Comment</h3>
<div class="commentform">
<form class="form-horizontal" method="post" action="#commentform">
<div style="display:none;"><input id="csrf_token" name="csrf_token" value="20140210210133##e393feb02b92b5c9594dac6606093ae22b815a59" type="hidden"></div>

<div class="control-group">
    <label class="control-label" for="name">Name <span class="label label-important">*</span></label>
    <div class="controls"><input class="span5" id="name" name="name" type="text"></div>
</div>
<div class="control-group">
    <label class="control-label" for="url">Website</label>
    <div class="controls"><input class="span5" id="url" name="url" type="text"></div>
</div>
<div class="control-group">
    <label class="control-label" for="email">Email <span class="label label-important">*</span></label>
    <div class="controls"><input class="span5" id="email" name="email" type="text"></div>
</div>

<div class="control-group">
    <label class="control-label" for="comment">Comment <span class="label label-important">*</span></label>
    <div class="controls"><textarea class="span5" id="comment" name="comment" rows="4"></textarea><img style="cursor: pointer ! important; display: none ! important; position: absolute ! important; padding: 0px ! important; margin: 0px ! important; border: medium none ! important; width: 28px ! important; height: 14px ! important; opacity: 0.0152174 ! important; left: 664px ! important; top: 18626px ! important;" title="It's All Text!" src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/gumdrop.png"></div>
</div>

<div class="control-group">
    <div class="controls">
<script type="text/javascript">var RecaptchaOptions = {"theme": "white", "custom_translations": {"incorrect_try_again": "Incorrect. Try again.", "help_btn": "Help", "cant_hear_this": "Download sound as MP3", "instructions_audio": "Type what you hear:", "instructions_visual": "Type the two words:", "refresh_btn": "Get a new challenge", "play_again": "Play sound again", "visual_challenge": "Get a visual challenge", "audio_challenge": "Get an audio challenge"}};</script>
<script type="text/javascript" src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/challenge.js"></script><script type="text/javascript" src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/recaptcha.js"></script><div class=" recaptcha_nothad_incorrect_sol recaptcha_isnot_showing_audio" id="recaptcha_widget_div" style=""><div id="recaptcha_area"><table id="recaptcha_table" class="recaptchatable recaptcha_theme_white"> <tbody><tr> <td colspan="6" class="recaptcha_r1_c1"></td> </tr> <tr> <td class="recaptcha_r2_c1"></td> <td colspan="4" class="recaptcha_image_cell"><center><div style="width: 300px; height: 57px;" id="recaptcha_image"><img id="recaptcha_challenge_image" alt="reCAPTCHA challenge image" src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/image.jpg" height="57" width="300"></div></center></td> <td class="recaptcha_r2_c2"></td> </tr> <tr> <td rowspan="6" class="recaptcha_r3_c1"></td> <td colspan="4" class="recaptcha_r3_c2"></td> <td rowspan="6" class="recaptcha_r3_c3"></td> </tr> <tr> <td rowspan="3" class="recaptcha_r4_c1" height="49"> <div class="recaptcha_input_area"> <span style="display: none;" id="recaptcha_challenge_field_holder"><input name="recaptcha_challenge_field" id="recaptcha_challenge_field" value="03AHJ_Vus2BjPH8Btwahd3Ah-5kpJ9PT3Dbr81dv4kCdk_S-oa5USCQeWGKof8KidYhhjp-dO-MKqyGp-f9FQ40meaxz6EoQCMdYyN6Cl_HGjeLawtBpLnrLJ7AU81QJUicV_bbyS333fv4uRwaMzGiLANioR5TVHMaOPlsZNeEE5zeNdiqHmxglk" type="hidden"></span><input autocomplete="off" name="recaptcha_response_field" id="recaptcha_response_field" autocorrect="off" autocapitalize="off" placeholder="Type the two words" type="text"> <span id="recaptcha_privacy" class="recaptcha_only_if_privacy"><a target="_blank" href="http://www.google.com/intl/en/policies/">Privacy &amp; Terms</a></span> </div> </td> <td rowspan="4" class="recaptcha_r4_c2"></td> <td><a title="Get a new challenge" id="recaptcha_reload_btn"><img alt="Get a new challenge" src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/refresh.gif" id="recaptcha_reload" height="17" width="25"></a></td> <td rowspan="4" class="recaptcha_r4_c4"></td> </tr> <tr> <td><a title="Get an audio challenge" id="recaptcha_switch_audio_btn" class="recaptcha_only_if_image"><img src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/audio.gif" id="recaptcha_switch_audio" alt="Get an audio challenge" height="16" width="25"></a><a title="Get a visual challenge" id="recaptcha_switch_img_btn" class="recaptcha_only_if_audio"><img src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/text.gif" id="recaptcha_switch_img" alt="Get a visual challenge" height="16" width="25"></a></td> </tr> <tr> <td><a title="Help" id="recaptcha_whatsthis_btn"><img alt="Help" src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/help.gif" id="recaptcha_whatsthis" height="16" width="25"></a></td> </tr> <tr> <td class="recaptcha_r7_c1"></td> <td class="recaptcha_r8_c1"></td> </tr> </tbody></table> </div></div>
<noscript>
  <div><iframe src="http://api.recaptcha.net/noscript?k=6Ld5Zs4SAAAAAOY0DOi4r18bgHlEaz41qAoRf__S" height="300" width="500"></iframe></div>
  <div><textarea name="recaptcha_challenge_field" rows="3" cols="40"></textarea>
  <input type="hidden" name="recaptcha_response_field" value="manual_challenge"></div>
</noscript>
</div>
</div>

<div class="control-group">
    <div class="controls"><input name="submit" class="btn btn-primary" value="Post Comment" type="submit"> <span class="help-inline">Note: all comments are screened before they are published. Thank you for your patience!</span></div>
</div>
</form>
</div>


</div>

            </div>
        </div>
        <div class="span4">
            <div id="sidebar">
                <h1>About Miguel</h1>
                <img style="float: right; margin: 0px 8px 8px 0px; padding: 4px; border: 1px solid #ccc;" src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/miguel.jpg">
                <p>Welcome to my blog!</p>
                <p>I'm a software engineer, photographer and filmmaker in Portland, Oregon, USA.</p>
                <p>You can also find me on <a href="https://www.facebook.com/miguelgrinbergblog">Facebook</a>, <a href="https://plus.google.com/u/0/117786742456929977820">Google+</a>, <a href="http://www.linkedin.com/in/miguelgrinberg">LinkedIn</a> and <a href="https://twitter.com/#%21/miguelgrinberg">Twitter</a>.</p>
                <p>Thank you for visiting!</p>
                <h1>Flask Web Development Book</h1>
                <p>I'm currently writing a book on web development with 
Python and Flask, to be published by O'Reilly Media in 2014. The 
official site for this book is <a href="http://flaskbook.com/">http://flaskbook.com</a>.</p>
                <center><a href="http://flaskbook.com/"><img style="border: 1px solid black;" src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/flask-book-cover-tiny.png"></a></center>
                <h1>Flask Tutorial at PyCon 2014</h1>
                <p>If you want to learn Flask in a class setting then I 
hope you will consider my upcoming tutorial session at PyCon 2014 in 
Montréal on April 10th, 2014. Visit the <a href="https://us.pycon.org/2014/schedule/presentation/54/">tutorial page</a> for more information. I hope to see you there!</p>
                <center><a href="https://us.pycon.org/2014/schedule/presentation/54/"><img src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/pycon2014-blog-image.png"></a></center>
                
                		<h1>Categories</h1>
		<ul>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Arduino/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/rss-small.png" title="Arduino RSS Feed" label="Arduino RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Arduino">Arduino</a></span> (7)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Blog/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/rss-small.png" title="Blog RSS Feed" label="Blog RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Blog">Blog</a></span> (1)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/C++/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/rss-small.png" title="C++ RSS Feed" label="C++ RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/C++">C++</a></span> (5)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Cloud/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/rss-small.png" title="Cloud RSS Feed" label="Cloud RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Cloud">Cloud</a></span> (1)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Filmmaking/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/rss-small.png" title="Filmmaking RSS Feed" label="Filmmaking RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Filmmaking">Filmmaking</a></span> (6)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Flask/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/rss-small.png" title="Flask RSS Feed" label="Flask RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Flask">Flask</a></span> (28)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Games/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/rss-small.png" title="Games RSS Feed" label="Games RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Games">Games</a></span> (1)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Gear/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/rss-small.png" title="Gear RSS Feed" label="Gear RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Gear">Gear</a></span> (6)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/HTML5/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/rss-small.png" title="HTML5 RSS Feed" label="HTML5 RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/HTML5">HTML5</a></span> (1)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Heroku/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/rss-small.png" title="Heroku RSS Feed" label="Heroku RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Heroku">Heroku</a></span> (1)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Javascript/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/rss-small.png" title="Javascript RSS Feed" label="Javascript RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Javascript">Javascript</a></span> (3)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Movie%20Reviews/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/rss-small.png" title="Movie Reviews RSS Feed" label="Movie Reviews RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Movie%20Reviews">Movie Reviews</a></span> (5)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Netflix/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/rss-small.png" title="Netflix RSS Feed" label="Netflix RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Netflix">Netflix</a></span> (5)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Node.js/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/rss-small.png" title="Node.js RSS Feed" label="Node.js RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Node.js">Node.js</a></span> (1)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Personal/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/rss-small.png" title="Personal RSS Feed" label="Personal RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Personal">Personal</a></span> (1)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Photography/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/rss-small.png" title="Photography RSS Feed" label="Photography RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Photography">Photography</a></span> (6)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Product%20Reviews/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/rss-small.png" title="Product Reviews RSS Feed" label="Product Reviews RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Product%20Reviews">Product Reviews</a></span> (1)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Programming/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/rss-small.png" title="Programming RSS Feed" label="Programming RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Programming">Programming</a></span> (36)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Project%20Management/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/rss-small.png" title="Project Management RSS Feed" label="Project Management RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Project%20Management">Project Management</a></span> (1)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Python/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/rss-small.png" title="Python RSS Feed" label="Python RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Python">Python</a></span> (29)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/REST/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/rss-small.png" title="REST RSS Feed" label="REST RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/REST">REST</a></span> (4)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Raspberry%20Pi/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/rss-small.png" title="Raspberry Pi RSS Feed" label="Raspberry Pi RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Raspberry%20Pi">Raspberry Pi</a></span> (4)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/RhinoSteady/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/rss-small.png" title="RhinoSteady RSS Feed" label="RhinoSteady RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/RhinoSteady">RhinoSteady</a></span> (6)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Robotics/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/rss-small.png" title="Robotics RSS Feed" label="Robotics RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Robotics">Robotics</a></span> (6)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Video/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20VIII_%20Followers,%20Contacts%20And%20Friends%20-%20miguelgrinberg.com_files/rss-small.png" title="Video RSS Feed" label="Video RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Video">Video</a></span> (2)</li>
		
		</ul>

                
            </div>
        </div>
    </div>
	<div id="footer">
        <p class="elapsed">This page was generated in 0.1 seconds.</p>
		<p>© 2013 by Miguel Grinberg. All rights reserved. <a href="mailto:webmaster%20_at_%20miguelgrinberg%20_dot_%20com">Questions?</a></p>
	</div>
</div>
<div id="wrap">
</div>
<div style="display: none;" id="cboxOverlay"></div><div style="display: none; padding-bottom: 42px; padding-right: 42px;" class="" id="colorbox"><div id="cboxWrapper"><div><div style="float: left;" id="cboxTopLeft"></div><div style="float: left;" id="cboxTopCenter"></div><div style="float: left;" id="cboxTopRight"></div></div><div style="clear: left;"><div style="float: left;" id="cboxMiddleLeft"></div><div style="float: left;" id="cboxContent"><div style="width: 0px; height: 0px; overflow: hidden; float: left;" id="cboxLoadedContent"></div><div style="float: left;" id="cboxLoadingOverlay"></div><div style="float: left;" id="cboxLoadingGraphic"></div><div style="float: left;" id="cboxTitle"></div><div style="float: left;" id="cboxCurrent"></div><div style="float: left;" id="cboxNext"></div><div style="float: left;" id="cboxPrevious"></div><div style="float: left;" id="cboxSlideshow"></div><div style="float: left;" id="cboxClose"></div></div><div style="float: left;" id="cboxMiddleRight"></div></div><div style="clear: left;"><div style="float: left;" id="cboxBottomLeft"></div><div style="float: left;" id="cboxBottomCenter"></div><div style="float: left;" id="cboxBottomRight"></div></div></div><div style="position: absolute; width: 9999px; visibility: hidden; display: none;"></div></div><div style="right: 20px ! important; top: 15px ! important; background: none repeat scroll 0% 0% rgb(51, 0, 51) ! important; cursor: pointer;" id="sjbdmztoiakqzbwisrcjdtbzantxeetjgreqv"><div style="background: none repeat scroll 0% 0% rgb(51, 0, 51) ! important;"><span class="sjbdmztoiakqzbwisrcjdtbzantxeetjgreqv-blocked">Facebook Connect</span><br><span class="sjbdmztoiakqzbwisrcjdtbzantxeetjgreqv-blocked">Google +1</span><br><span class="sjbdmztoiakqzbwisrcjdtbzantxeetjgreqv-blocked">Google Analytics</span><br><span class="sjbdmztoiakqzbwisrcjdtbzantxeetjgreqv-blocked">Gravatar</span><br><span class="sjbdmztoiakqzbwisrcjdtbzantxeetjgreqv-blocked">LinkedIn Widgets</span><br><span class="sjbdmztoiakqzbwisrcjdtbzantxeetjgreqv-blocked">Twitter Button</span><br></div></div></body></html>