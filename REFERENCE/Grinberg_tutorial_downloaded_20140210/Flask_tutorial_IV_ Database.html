<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en"><script src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/widgets.js" id="twitter-wjs"></script><script id="bug.surrogate.20">FB={Event:{subscribe:function(){}},UIServer:{},XFBML:{parse:function(){}},init:function(){},__noSuchMethod__:function(){}};</script><script src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/all.js" id="facebook-jssdk"></script><script id="bug.surrogate.1">var urchinTracker=function(){},_gaq={push:function(){try {if(arguments[0][0]=='_link')window.location.href=arguments[0][1]}catch(er){}}},_gat={_createTracker:function(){}, _getTracker:function(){return{__noSuchMethod__:function(){},_link:function(o){if(o)location.href=o;},_linkByPost:function(){return true;},_getLinkerUrl:function(o){return o;},_trackEvent:function(){}}}};</script><head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

	<title>The Flask Mega-Tutorial, Part IV: Database - miguelgrinberg.com</title>

	<meta name="description" content="miguelgrinberg.com">
	<meta name="copyright" content="Copyright (c) 2012 Miguel Grinberg">
	<meta name="author" content="Miguel Grinberg">
    
    <meta name="keywords" content="python, programming, flask, web, tutorial, database, sqlalchemy">
    
    <link rel="shortcut icon" href="http://blog.miguelgrinberg.com/static/favicon.ico">
	<link rel="alternate" type="application/rss+xml" href="http://blog.miguelgrinberg.com/feed" title="miguelgrinberg.com RSS feed">
    <link href="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/prettify.css" type="text/css" rel="stylesheet">
    <link href="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/colorbox.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/jquery_002.js"></script>
	<script type="text/javascript" src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/jquery.js"></script>
    <script type="text/javascript" src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/moment.js"></script>
    <script type="text/javascript" src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/prettify.js"></script>
    <link href="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/bootstrap.css" rel="stylesheet" media="screen">
    <link href="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/bootstrap-responsive.css" rel="stylesheet">
    <link href="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/style.css" rel="stylesheet" type="text/css">
    <script src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/bootstrap.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style type="text/css" media="screen, print, projection">
    </style>
    
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-4777284-15']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    
    <script type="text/javascript">
        $(document).ready(function(){
            $(".gallery").colorbox({rel:".gallery",maxWidth:"95%",maxHeight:"95%",scalePhotos:true});
            // add prettyprint class to all <pre><code></code></pre> blocks
            var prettify = false;
            $("pre code").parent().each(function() {
                $(this).addClass('prettyprint');
                prettify = true;
            });
            prettyPrint();
        });
    </script>
<style type="text/css">.recaptchatable td img{display:block}.recaptchatable .recaptcha_r1_c1{background:url('http://www.google.com/recaptcha/api/img/white/sprite.png') 0 -63px no-repeat;width:318px;height:9px}.recaptchatable .recaptcha_r2_c1{background:url('http://www.google.com/recaptcha/api/img/white/sprite.png') -18px 0 no-repeat;width:9px;height:57px}.recaptchatable .recaptcha_r2_c2{background:url('http://www.google.com/recaptcha/api/img/white/sprite.png') -27px 0 no-repeat;width:9px;height:57px}.recaptchatable .recaptcha_r3_c1{background:url('http://www.google.com/recaptcha/api/img/white/sprite.png') 0 0 no-repeat;width:9px;height:63px}.recaptchatable .recaptcha_r3_c2{background:url('http://www.google.com/recaptcha/api/img/white/sprite.png') -18px -57px no-repeat;width:300px;height:6px}.recaptchatable .recaptcha_r3_c3{background:url('http://www.google.com/recaptcha/api/img/white/sprite.png') -9px 0 no-repeat;width:9px;height:63px}.recaptchatable .recaptcha_r4_c1{background:url('http://www.google.com/recaptcha/api/img/white/sprite.png') -43px 0 no-repeat;width:171px;height:49px}.recaptchatable .recaptcha_r4_c2{background:url('http://www.google.com/recaptcha/api/img/white/sprite.png') -36px 0 no-repeat;width:7px;height:57px}.recaptchatable .recaptcha_r4_c4{background:url('http://www.google.com/recaptcha/api/img/white/sprite.png') -214px 0 no-repeat;width:97px;height:57px}.recaptchatable .recaptcha_r7_c1{background:url('http://www.google.com/recaptcha/api/img/white/sprite.png') -43px -49px no-repeat;width:171px;height:8px}.recaptchatable .recaptcha_r8_c1{background:url('http://www.google.com/recaptcha/api/img/white/sprite.png') -43px -49px no-repeat;width:25px;height:8px}.recaptchatable .recaptcha_image_cell center img{height:57px}.recaptchatable .recaptcha_image_cell center{height:57px}.recaptchatable .recaptcha_image_cell{background-color:white;height:57px}#recaptcha_area,#recaptcha_table{width:318px!important}.recaptchatable,#recaptcha_area tr,#recaptcha_area td,#recaptcha_area th{margin:0!important;border:0!important;padding:0!important;border-collapse:collapse!important;vertical-align:middle!important}.recaptchatable *{margin:0;padding:0;border:0;font-family:helvetica,sans-serif;font-size:8pt;color:black;position:static;top:auto;left:auto;right:auto;bottom:auto}.recaptchatable #recaptcha_image{position:relative;margin:auto}.recaptchatable #recaptcha_image #recaptcha_challenge_image{display:block}.recaptchatable #recaptcha_image #recaptcha_ad_image{display:block;position:absolute;top:0}.recaptchatable img{border:0!important;margin:0!important;padding:0!important}.recaptchatable a,.recaptchatable a:hover{cursor:pointer;outline:none;border:0!important;padding:0!important;text-decoration:none;color:blue;background:none!important;font-weight:normal}.recaptcha_input_area{position:relative!important;width:153px!important;height:45px!important;margin-left:7px!important;margin-right:7px!important;background:none!important}.recaptchatable label.recaptcha_input_area_text{margin:0!important;padding:0!important;position:static!important;top:auto!important;left:auto!important;right:auto!important;bottom:auto!important;background:none!important;height:auto!important;width:auto!important}.recaptcha_theme_red label.recaptcha_input_area_text,.recaptcha_theme_white label.recaptcha_input_area_text{color:black!important}.recaptcha_theme_blackglass label.recaptcha_input_area_text{color:white!important}.recaptchatable #recaptcha_response_field{width:153px!important;position:relative!important;bottom:7px!important;padding:0!important;margin:15px 0 0 0!important;font-size:10pt}.recaptcha_theme_blackglass #recaptcha_response_field,.recaptcha_theme_white #recaptcha_response_field{border:1px solid gray}.recaptcha_theme_red #recaptcha_response_field{border:1px solid #cca940}.recaptcha_audio_cant_hear_link{font-size:7pt;color:black}.recaptchatable{line-height:1!important}#recaptcha_instructions_error{color:red!important}.recaptcha_only_if_privacy{float:right;text-align:right}#recaptcha-ad-choices{position:absolute;height:15px;top:0;right:0}#recaptcha-ad-choices img{height:15px}.recaptcha-ad-choices-collapsed{width:15px;height:15px;display:block}.recaptcha-ad-choices-expanded{width:75px;height:15px;display:none}#recaptcha-ad-choices:hover .recaptcha-ad-choices-collapsed{display:none}#recaptcha-ad-choices:hover .recaptcha-ad-choices-expanded{display:block}

.recaptcha_is_showing_audio .recaptcha_only_if_image,.recaptcha_isnot_showing_audio .recaptcha_only_if_audio,.recaptcha_had_incorrect_sol .recaptcha_only_if_no_incorrect_sol,.recaptcha_nothad_incorrect_sol .recaptcha_only_if_incorrect_sol{display:none !important}</style><style>#psldgdskyeisgppkwkmbawbtizhmddhgl{border:solid 2px #fff !important;color:#fff !important;display:block !important;height:auto !important;margin:0 !important;opacity:0.9 !important;padding:7px 10px !important;position:fixed !important;visibility:visible !important;width:auto !important;z-index:2147483647 !important;-moz-border-radius:5px !important;border-radius:5px !important;-moz-box-shadow:0px 0px 20px #000 !important;box-shadow:0px 0px 20px #000 !important;}.psldgdskyeisgppkwkmbawbtizhmddhgl-blocked{color:#777 !important;display:inline !important;text-decoration:line-through !important;}#psldgdskyeisgppkwkmbawbtizhmddhgl span{background:transparent !important;}#psldgdskyeisgppkwkmbawbtizhmddhgl div{border:0 !important;margin:0 !important;padding:0 !important;width:auto !important;letter-spacing:normal !important;font:13px Arial,Helvetica !important;text-align:left !important;text-shadow:none !important;text-transform:none !important;word-spacing:normal !important;}#psldgdskyeisgppkwkmbawbtizhmddhgl a{font-weight:normal !important;background:none !important;text-decoration:underline !important;color:#fff !important;}@media print{#psldgdskyeisgppkwkmbawbtizhmddhgl{display:none !important;}}</style></head>
<body style="padding-top: 40px;">
<!-- facebook sdk -->
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<!-- google plus sdk -->
<script type="text/javascript" src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/plusone.js"></script>
<!-- twitter sdk -->
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
<!-- linkedin sdk -->
<script src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/in.js" type="text/javascript"></script>
<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
            <a class="brand" href="http://blog.miguelgrinberg.com/">miguelgrinberg.com</a>
            <ul class="nav">
                <li><a href="http://blog.miguelgrinberg.com/">Home</a></li>
                <li><a href="http://blog.miguelgrinberg.com/post/about-me">About Me</a></li>
                <li><a href="http://blog.miguelgrinberg.com/post/about-this-blog">About This Blog</a></li>
				
            </ul>
            <div class="nav pull-right">
                <p class="navbar-text">
                    <a type="application/rss+xml" href="http://blog.miguelgrinberg.com/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/rss.png" alt="RSS Feed" title="RSS Feed"></a>
                    <a href="https://www.facebook.com/miguelgrinbergblog"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/facebook.png" alt="Facebook" title="Facebook"></a>
                    <a href="https://plus.google.com/u/0/117786742456929977820"><img class="yfapaxbwxrlpkwtnwicp" src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/googleplus.png" alt="Google+" title="Google+"></a>
                    <a href="http://www.linkedin.com/in/miguelgrinberg"><img class="yfapaxbwxrlpkwtnwicp" src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/linkedin.png" alt="LinkedIn" title="LinkedIn"></a>
                    <a href="https://twitter.com/#%21/miguelgrinberg"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/twitter.png" alt="Twitter" title="Twitter"></a>
                </p>
            </div>
        </div>
    </div>
</div>
<div id="banner"></div>
<div class="container">
    <div class="row">
        <div class="span8">
            <div id="main">
                
                
                
                
                

<div class="post">
<p class="date">
<script type="text/javascript">
document.write(moment("2012-05-20T07:30:21Z").format("LL"));
</script>May 20 2012
</p>
<div class="social-outer">
    <div class="social">
        <div class="social-box"><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-iv-database" data-via="miguelgrinberg" data-count="vertical">Tweet</a></div>
        <div class="social-box" style="padding-left: 6px;"><div style="display: block;" class="fb-like" data-href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-iv-database" data-send="false" data-layout="box_count" data-width="450" data-show-faces="false" data-font="verdana"><iframe style="width: 30px; height: 19px; border: 0px none;" id="wsofxtxrawwtrmohegcdlabsioihyoxaqqbftd"></iframe></div></div>
        <div class="social-box"><g:plusone href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-iv-database" size="tall"></g:plusone></div>
        <div class="social-box"><script type="IN/Share" data-url="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-iv-database" data-counter="top"></script></div>
    </div>
</div>
<h1 class="post-title">The Flask Mega-Tutorial, Part IV: Database</h1>
<div class="posted">Posted by <span class="label label-important"><a href="http://blog.miguelgrinberg.com/author/Miguel%20Grinberg">Miguel Grinberg</a></span> under <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Python">Python</a></span>, <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Programming">Programming</a></span>, <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Flask">Flask</a></span>. </div>
<div class="post_body"><p>This is the fourth article in the series in which I document my experience writing web applications in <a href="http://python.org/">Python</a> using the <a href="http://flask.pocoo.org/">Flask</a> microframework.</p>
<p>The goal of the tutorial series is to develop a decently featured 
microblogging application that demonstrating total lack of originality I
 have decided to call <code>microblog</code>.</p>
<p>Here is an index of all the articles in the series that have been published to date:</p>
<ul>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-i-hello-world">Part I: Hello, World!</a></li>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-ii-templates">Part II: Templates</a></li>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-iii-web-forms">Part III: Web Forms</a></li>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-iv-database">Part IV: Database</a> (this article)</li>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-v-user-logins">Part V: User Logins</a></li>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-vi-profile-page-and-avatars">Part VI: Profile Page And Avatars</a></li>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-vii-unit-testing">Part VII: Unit Testing</a></li>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-viii-followers-contacts-and-friends">Part VIII: Followers, Contacts And Friends</a></li>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-ix-pagination">Part IX: Pagination</a></li>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-x-full-text-search">Part X: Full Text Search</a></li>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xi-email-support">Part XI: Email Support</a></li>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xii-facelift">Part XII: Facelift</a></li>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xiii-dates-and-times">Part XIII: Dates and Times</a></li>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xiv-i18n-and-l10n">Part XIV: I18n and L10n</a></li>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xv-ajax">Part XV: Ajax</a></li>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xvi-debugging-testing-and-profiling">Part XVI: Debugging, Testing and Profiling</a></li>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xvii-deployment-on-linux-even-on-the-raspberry-pi">Part XVII: Deployment on Linux (even on the Raspberry Pi!)</a></li>
<li><a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xviii-deployment-on-the-heroku-cloud">Part XVIII: Deployment on the Heroku Cloud</a></li>
</ul>
<h2>Recap</h2>
<p>In the previous chapter of the series we created our login form, complete with submission and validation.</p>
<p>In this article we are going to create our database and set it up so that we can record our users in it.</p>
<p>To follow this chapter along you need to have the <code>microblog</code> app as we left it at the end of the previous chapter. Please make sure the app is installed and running.</p>
<h2>Running Python scripts from the command line</h2>
<p>In this chapter we are going to write a few scripts that simplify the
 management of our database. Before we get into that let's review how a 
Python script is executed on the command line.</p>
<p>If you are on Linux or OS X, then scripts have to be given executable permission, like this:</p>
<pre class="prettyprint"><code><span class="pln">chmod a</span><span class="pun">+</span><span class="pln">x script</span><span class="pun">.</span><span class="pln">py</span></code></pre>
<p>The script has a <a href="http://en.wikipedia.org/wiki/Shebang_%28Unix%29">shebang</a>
 line, which points to the interpreter that should be used. A script 
that has been given executable permission and has a shebang line can be 
executed simply like this:</p>
<pre class="prettyprint"><code><span class="pun">./</span><span class="pln">script</span><span class="pun">.</span><span class="pln">py </span><span class="str">&lt;arguments&gt;</span></code></pre>
<p>On Windows, however, this does not work, and instead you have to 
provide the script as an argument to the chosen Python interpreter:</p>
<pre class="prettyprint"><code><span class="pln">flask\Scripts\python script</span><span class="pun">.</span><span class="pln">py </span><span class="str">&lt;arguments&gt;</span></code></pre>
<p>To avoid having to type the path to the Python interpreter you can add your <code>microblog/flask/Scripts</code> directory to the system path, making sure it appears before your regular Python interpreter.</p>
<p>From now on, in this tutorial the Linux/OS X syntax will be used for 
brevity. If you are on Windows remember to convert the syntax 
appropriately.</p>
<h2>Databases in Flask</h2>
<p>We will use the <a href="http://packages.python.org/Flask-SQLAlchemy">Flask-SQLAlchemy</a> extension to manage our application. This extension provides a wrapper for the <a href="http://www.sqlalchemy.org/">SQLAlchemy</a> project, which is an <a href="http://en.wikipedia.org/wiki/Object-relational_mapping">Object Relational Mapper</a> or ORM.</p>
<p>ORMs allow database applications to work with objects instead of 
tables and SQL. The operations performed on the objects are translated 
into database commands transparently by the ORM. This effectively means 
that we will not be learning SQL in this tutorial, we will let 
Flask-SQLAlchemy speak SQL for us.</p>
<h2>Migrations</h2>
<p>Most database tutorials I've seen cover creation and use of a 
database, but do not adequately address the problem of updating a 
database as the application grows. Typically you end up having to delete
 the old database and create a new one each time you need to make 
updates, losing all the data. And if the data cannot be recreated easily
 you may be forced to write export and import scripts yourself.</p>
<p>Luckily, we have a much better option.</p>
<p>We are going to use <a href="http://code.google.com/p/sqlalchemy-migrate">SQLAlchemy-migrate</a>
 to keep track of database updates for us. It adds a bit of work to get a
 database started, but that is a small price to pay for never having to 
worry about manual database migrations.</p>
<p>Enough theory, let's get started!</p>
<h2>Configuration</h2>
<p>For our little application we will use a sqlite database. The sqlite 
databases are the most convenient choice for small applications, as each
 database is stored in a single file.</p>
<p>We have a couple of new configuration items to add to our config file (file <code>config.py</code>):</p>
<pre class="prettyprint"><code><span class="kwd">import</span><span class="pln"> os
basedir </span><span class="pun">=</span><span class="pln"> os</span><span class="pun">.</span><span class="pln">path</span><span class="pun">.</span><span class="pln">abspath</span><span class="pun">(</span><span class="pln">os</span><span class="pun">.</span><span class="pln">path</span><span class="pun">.</span><span class="pln">dirname</span><span class="pun">(</span><span class="pln">__file__</span><span class="pun">))</span><span class="pln">

SQLALCHEMY_DATABASE_URI </span><span class="pun">=</span><span class="pln"> </span><span class="str">'sqlite:///'</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> os</span><span class="pun">.</span><span class="pln">path</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="pln">basedir</span><span class="pun">,</span><span class="pln"> </span><span class="str">'app.db'</span><span class="pun">)</span><span class="pln">
SQLALCHEMY_MIGRATE_REPO </span><span class="pun">=</span><span class="pln"> os</span><span class="pun">.</span><span class="pln">path</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="pln">basedir</span><span class="pun">,</span><span class="pln"> </span><span class="str">'db_repository'</span><span class="pun">)</span></code></pre>
<p>The SQLALCHEMY_DATABASE_URI is required by the Flask-SQLAlchemy extension. This is the path of our database file.</p>
<p>The SQLALCHEMY_MIGRATE_REPO is the folder where we will store the SQLAlchemy-migrate data files.</p>
<p>Finally, when we initialize our app we also need to initialize our database. Here is our updated package init file (file <code>app/__init__.py</code>):</p>
<pre class="prettyprint"><code><span class="kwd">from</span><span class="pln"> flask </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">Flask</span><span class="pln">
</span><span class="kwd">from</span><span class="pln"> flask</span><span class="pun">.</span><span class="pln">ext</span><span class="pun">.</span><span class="pln">sqlalchemy </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">SQLAlchemy</span><span class="pln">

app </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Flask</span><span class="pun">(</span><span class="pln">__name__</span><span class="pun">)</span><span class="pln">
app</span><span class="pun">.</span><span class="pln">config</span><span class="pun">.</span><span class="pln">from_object</span><span class="pun">(</span><span class="str">'config'</span><span class="pun">)</span><span class="pln">
db </span><span class="pun">=</span><span class="pln"> </span><span class="typ">SQLAlchemy</span><span class="pun">(</span><span class="pln">app</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">from</span><span class="pln"> app </span><span class="kwd">import</span><span class="pln"> views</span><span class="pun">,</span><span class="pln"> models</span></code></pre>
<p>Note the two changes we have made to our init script. We are now creating a <code>db</code> object that will be our database, and we are also importing a new module called <code>models</code>. We will write this module next.</p>
<h2>The database model</h2>
<p>The data that we will store in our database will be represented by a 
collection of classes that are referred to as the database models. The 
ORM layer will do the translations required to map objects created from 
these classes into rows in the proper database table.</p>
<p>Let's start by creating a model that will represent our users. Using the <a href="http://ondras.zarovi.cz/sql/demo">WWW SQL Designer</a> tool, I have made the following diagram to represent our users table:</p>
<p><img alt="users table" src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/flask-mega-tutorial-part-iv-1.png"></p>
<p>The <code>id</code> field is usually in all models, and is used as the <em>primary key</em>.
 Each user in the database will be assigned a unique id value, stored in
 this field. Luckily this is done automatically for us, we just need to 
provide the <code>id</code> field.</p>
<p>The <code>nickname</code> and <code>email</code> fields are defined 
as strings (or VARCHAR in database jargon), and their maximum lengths 
are specified so that the database can optimize space usage.</p>
<p>The <code>role</code> field is an integer, we will use it to keep track of which users are admins and which are not.</p>
<p>Now that we have decided what we want our users table to look like, the job of translating that into code is pretty easy (file <code>app/models.py</code>):</p>
<pre class="prettyprint"><code><span class="kwd">from</span><span class="pln"> app </span><span class="kwd">import</span><span class="pln"> db

ROLE_USER </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
ROLE_ADMIN </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">User</span><span class="pun">(</span><span class="pln">db</span><span class="pun">.</span><span class="typ">Model</span><span class="pun">):</span><span class="pln">
    id </span><span class="pun">=</span><span class="pln"> db</span><span class="pun">.</span><span class="typ">Column</span><span class="pun">(</span><span class="pln">db</span><span class="pun">.</span><span class="typ">Integer</span><span class="pun">,</span><span class="pln"> primary_key </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">True</span><span class="pun">)</span><span class="pln">
    nickname </span><span class="pun">=</span><span class="pln"> db</span><span class="pun">.</span><span class="typ">Column</span><span class="pun">(</span><span class="pln">db</span><span class="pun">.</span><span class="typ">String</span><span class="pun">(</span><span class="lit">64</span><span class="pun">),</span><span class="pln"> index </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">True</span><span class="pun">,</span><span class="pln"> unique </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">True</span><span class="pun">)</span><span class="pln">
    email </span><span class="pun">=</span><span class="pln"> db</span><span class="pun">.</span><span class="typ">Column</span><span class="pun">(</span><span class="pln">db</span><span class="pun">.</span><span class="typ">String</span><span class="pun">(</span><span class="lit">120</span><span class="pun">),</span><span class="pln"> index </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">True</span><span class="pun">,</span><span class="pln"> unique </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">True</span><span class="pun">)</span><span class="pln">
    role </span><span class="pun">=</span><span class="pln"> db</span><span class="pun">.</span><span class="typ">Column</span><span class="pun">(</span><span class="pln">db</span><span class="pun">.</span><span class="typ">SmallInteger</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> ROLE_USER</span><span class="pun">)</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> __repr__</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">):</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="str">'&lt;User %r&gt;'</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">self</span><span class="pun">.</span><span class="pln">nickname</span><span class="pun">)</span></code></pre>
<p>The <code>User</code> class that we just created contains several fields, defined as class variables. Fields are created as instances of the <code>db.Column</code>
 class, which takes the field type as an argument, plus other optional 
arguments that allow us, for example, to indicate which fields are 
unique and indexed.</p>
<p>The <code>__repr__</code> method tells Python how to print objects of this class. We will use this for debugging.</p>
<h2>Creating the database</h2>
<p>With the configuration and model in place we are now ready to create 
our database file. The SQLAlchemy-migrate package comes with command 
line tools and APIs to create databases in a way that allows easy 
updates in the future, so that is what we will use. I find the command 
line tools a bit awkward to use, so instead I have written my own set of
 little Python scripts that invoke the migration APIs.</p>
<p>Here is a script that creates the database (file <code>db_create.py</code>):</p>
<pre class="prettyprint"><code><span class="com">#!flask/bin/python</span><span class="pln">
</span><span class="kwd">from</span><span class="pln"> migrate</span><span class="pun">.</span><span class="pln">versioning </span><span class="kwd">import</span><span class="pln"> api
</span><span class="kwd">from</span><span class="pln"> config </span><span class="kwd">import</span><span class="pln"> SQLALCHEMY_DATABASE_URI
</span><span class="kwd">from</span><span class="pln"> config </span><span class="kwd">import</span><span class="pln"> SQLALCHEMY_MIGRATE_REPO
</span><span class="kwd">from</span><span class="pln"> app </span><span class="kwd">import</span><span class="pln"> db
</span><span class="kwd">import</span><span class="pln"> os</span><span class="pun">.</span><span class="pln">path
db</span><span class="pun">.</span><span class="pln">create_all</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">if</span><span class="pln"> </span><span class="kwd">not</span><span class="pln"> os</span><span class="pun">.</span><span class="pln">path</span><span class="pun">.</span><span class="pln">exists</span><span class="pun">(</span><span class="pln">SQLALCHEMY_MIGRATE_REPO</span><span class="pun">):</span><span class="pln">
    api</span><span class="pun">.</span><span class="pln">create</span><span class="pun">(</span><span class="pln">SQLALCHEMY_MIGRATE_REPO</span><span class="pun">,</span><span class="pln"> </span><span class="str">'database repository'</span><span class="pun">)</span><span class="pln">
    api</span><span class="pun">.</span><span class="pln">version_control</span><span class="pun">(</span><span class="pln">SQLALCHEMY_DATABASE_URI</span><span class="pun">,</span><span class="pln"> SQLALCHEMY_MIGRATE_REPO</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">else</span><span class="pun">:</span><span class="pln">
    api</span><span class="pun">.</span><span class="pln">version_control</span><span class="pun">(</span><span class="pln">SQLALCHEMY_DATABASE_URI</span><span class="pun">,</span><span class="pln"> SQLALCHEMY_MIGRATE_REPO</span><span class="pun">,</span><span class="pln"> api</span><span class="pun">.</span><span class="pln">version</span><span class="pun">(</span><span class="pln">SQLALCHEMY_MIGRATE_REPO</span><span class="pun">))</span></code></pre>
<p>Note how this script is completely generic. All the application 
specific pathnames are imported from the config file. When you start 
your own project you can just copy the script to the new app's directory
 and it will work right away.</p>
<p>To create the database you just need to execute this script (remember
 that if you are on Windows the command is slightly different):</p>
<pre class="prettyprint"><code><span class="pun">./</span><span class="pln">db_create</span><span class="pun">.</span><span class="pln">py</span></code></pre>
<p>After you run the command you will have a new <code>app.db</code> file. This is an empty sqlite database, created from the start to support migrations. You will also have a <code>db_repository</code>
 directory with some files inside. This is the place where 
SQLAlchemy-migrate stores its data files. Note that we do not regenerate
 the repository if it already exists. This will allow us to recreate the
 database while leaving the existing repository if we need to.</p>
<h2>Our first migration</h2>
<p>Now that we have defined our model, we can incorporate it into our 
database. We will consider any changes to the structure of the app 
database a <em>migration</em>, so this is our first, which will take us from an empty database to a database that can store users.</p>
<p>To generate a migration I use another little Python helper script (file <code>db_migrate.py</code>):</p>
<pre class="prettyprint"><code><span class="com">#!flask/bin/python</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> imp
</span><span class="kwd">from</span><span class="pln"> migrate</span><span class="pun">.</span><span class="pln">versioning </span><span class="kwd">import</span><span class="pln"> api
</span><span class="kwd">from</span><span class="pln"> app </span><span class="kwd">import</span><span class="pln"> db
</span><span class="kwd">from</span><span class="pln"> config </span><span class="kwd">import</span><span class="pln"> SQLALCHEMY_DATABASE_URI
</span><span class="kwd">from</span><span class="pln"> config </span><span class="kwd">import</span><span class="pln"> SQLALCHEMY_MIGRATE_REPO
migration </span><span class="pun">=</span><span class="pln"> SQLALCHEMY_MIGRATE_REPO </span><span class="pun">+</span><span class="pln"> </span><span class="str">'/versions/%03d_migration.py'</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> </span><span class="pun">(</span><span class="pln">api</span><span class="pun">.</span><span class="pln">db_version</span><span class="pun">(</span><span class="pln">SQLALCHEMY_DATABASE_URI</span><span class="pun">,</span><span class="pln"> SQLALCHEMY_MIGRATE_REPO</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
tmp_module </span><span class="pun">=</span><span class="pln"> imp</span><span class="pun">.</span><span class="pln">new_module</span><span class="pun">(</span><span class="str">'old_model'</span><span class="pun">)</span><span class="pln">
old_model </span><span class="pun">=</span><span class="pln"> api</span><span class="pun">.</span><span class="pln">create_model</span><span class="pun">(</span><span class="pln">SQLALCHEMY_DATABASE_URI</span><span class="pun">,</span><span class="pln"> SQLALCHEMY_MIGRATE_REPO</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">exec</span><span class="pln"> old_model </span><span class="kwd">in</span><span class="pln"> tmp_module</span><span class="pun">.</span><span class="pln">__dict__
script </span><span class="pun">=</span><span class="pln"> api</span><span class="pun">.</span><span class="pln">make_update_script_for_model</span><span class="pun">(</span><span class="pln">SQLALCHEMY_DATABASE_URI</span><span class="pun">,</span><span class="pln"> SQLALCHEMY_MIGRATE_REPO</span><span class="pun">,</span><span class="pln"> tmp_module</span><span class="pun">.</span><span class="pln">meta</span><span class="pun">,</span><span class="pln"> db</span><span class="pun">.</span><span class="pln">metadata</span><span class="pun">)</span><span class="pln">
open</span><span class="pun">(</span><span class="pln">migration</span><span class="pun">,</span><span class="pln"> </span><span class="str">"wt"</span><span class="pun">).</span><span class="pln">write</span><span class="pun">(</span><span class="pln">script</span><span class="pun">)</span><span class="pln">
api</span><span class="pun">.</span><span class="pln">upgrade</span><span class="pun">(</span><span class="pln">SQLALCHEMY_DATABASE_URI</span><span class="pun">,</span><span class="pln"> SQLALCHEMY_MIGRATE_REPO</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">print</span><span class="pln"> </span><span class="str">'New migration saved as '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> migration
</span><span class="kwd">print</span><span class="pln"> </span><span class="str">'Current database version: '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> str</span><span class="pun">(</span><span class="pln">api</span><span class="pun">.</span><span class="pln">db_version</span><span class="pun">(</span><span class="pln">SQLALCHEMY_DATABASE_URI</span><span class="pun">,</span><span class="pln"> SQLALCHEMY_MIGRATE_REPO</span><span class="pun">))</span></code></pre>
<p>The script looks complicated, but it doesn't really do much. The way 
SQLAlchemy-migrate creates a migration is by comparing the structure of 
the database (obtained in our case from file <code>app.db</code>) against the structure of our models (obtained from file <code>app/models.py</code>).
 The differences between the two are recorded as a migration script 
inside the migration repository. The migration script knows how to apply
 a migration or undo it, so it is always possible to upgrade or 
downgrade a database format.</p>
<p>While I have never had problems generating migrations automatically 
with the above script, I could see that sometimes it would be hard to 
determine what changes were made just by comparing the old and the new 
format. To make it easy for SQLAlchemy-migrate to determine the changes I
 never rename existing fields, I limit my changes to adding or removing 
models or fields, or changing types of existing fields. And I always 
review the generated migration script to make sure it is right.</p>
<p>It goes without saying that you should never attempt to migrate your 
database without having a backup, in case something goes wrong. Also 
never run a migration for the first time on a production database, 
always make sure the migration works correctly on a development 
database.</p>
<p>So let's go ahead and record our migration:</p>
<pre class="prettyprint"><code><span class="pun">./</span><span class="pln">db_migrate</span><span class="pun">.</span><span class="pln">py</span></code></pre>
<p>And the output from the script will be:</p>
<pre class="prettyprint"><code><span class="typ">New</span><span class="pln"> migration saved </span><span class="kwd">as</span><span class="pln"> db_repository</span><span class="pun">/</span><span class="pln">versions</span><span class="pun">/</span><span class="lit">001</span><span class="pln">_migration</span><span class="pun">.</span><span class="pln">py
</span><span class="typ">Current</span><span class="pln"> database version</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span></code></pre>
<p>The script shows where the migration script was stored, and also 
prints the current database version. The empty database version was 
version 0, after we migrated to include users we are at version 1.</p>
<h2>Database upgrades and downgrades</h2>
<p>By now you may be wondering why is it that important to go through the extra hassle of recording database migrations.</p>
<p>Imagine that you have your application in your development machine, 
and also have a copy deployed to a production server that is online and 
in use.</p>
<p>Let's say that for the next release of your app you have to introduce
 a change to your models, for example a new table needs to be added. 
Without migrations you would need to figure out how to change the format
 of your database, both in your development machine and then again in 
your server, and this could be a lot of work.</p>
<p>If you have database migration support, then when you are ready to 
release the new version of the app to your production server you just 
need to record a new migration, copy the migration scripts to your 
production server and run a simple script that applies the changes for 
you. The database upgrade can be done with this little Python script 
(file <code>db_upgrade.py</code>):</p>
<pre class="prettyprint"><code><span class="com">#!flask/bin/python</span><span class="pln">
</span><span class="kwd">from</span><span class="pln"> migrate</span><span class="pun">.</span><span class="pln">versioning </span><span class="kwd">import</span><span class="pln"> api
</span><span class="kwd">from</span><span class="pln"> config </span><span class="kwd">import</span><span class="pln"> SQLALCHEMY_DATABASE_URI
</span><span class="kwd">from</span><span class="pln"> config </span><span class="kwd">import</span><span class="pln"> SQLALCHEMY_MIGRATE_REPO
api</span><span class="pun">.</span><span class="pln">upgrade</span><span class="pun">(</span><span class="pln">SQLALCHEMY_DATABASE_URI</span><span class="pun">,</span><span class="pln"> SQLALCHEMY_MIGRATE_REPO</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">print</span><span class="pln"> </span><span class="str">'Current database version: '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> str</span><span class="pun">(</span><span class="pln">api</span><span class="pun">.</span><span class="pln">db_version</span><span class="pun">(</span><span class="pln">SQLALCHEMY_DATABASE_URI</span><span class="pun">,</span><span class="pln"> SQLALCHEMY_MIGRATE_REPO</span><span class="pun">))</span></code></pre>
<p>When you run the above script, the database will be upgraded to the 
latest revision, by applying the migration scripts stored in the 
database repository.</p>
<p>It is not a common need to have to downgrade a database to an old 
format, but just in case, SQLAlchemy-migrate supports this as well (file
 <code>db_downgrade.py</code>):</p>
<pre class="prettyprint"><code><span class="com">#!flask/bin/python</span><span class="pln">
</span><span class="kwd">from</span><span class="pln"> migrate</span><span class="pun">.</span><span class="pln">versioning </span><span class="kwd">import</span><span class="pln"> api
</span><span class="kwd">from</span><span class="pln"> config </span><span class="kwd">import</span><span class="pln"> SQLALCHEMY_DATABASE_URI
</span><span class="kwd">from</span><span class="pln"> config </span><span class="kwd">import</span><span class="pln"> SQLALCHEMY_MIGRATE_REPO
v </span><span class="pun">=</span><span class="pln"> api</span><span class="pun">.</span><span class="pln">db_version</span><span class="pun">(</span><span class="pln">SQLALCHEMY_DATABASE_URI</span><span class="pun">,</span><span class="pln"> SQLALCHEMY_MIGRATE_REPO</span><span class="pun">)</span><span class="pln">
api</span><span class="pun">.</span><span class="pln">downgrade</span><span class="pun">(</span><span class="pln">SQLALCHEMY_DATABASE_URI</span><span class="pun">,</span><span class="pln"> SQLALCHEMY_MIGRATE_REPO</span><span class="pun">,</span><span class="pln"> v </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">print</span><span class="pln"> </span><span class="str">'Current database version: '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> str</span><span class="pun">(</span><span class="pln">api</span><span class="pun">.</span><span class="pln">db_version</span><span class="pun">(</span><span class="pln">SQLALCHEMY_DATABASE_URI</span><span class="pun">,</span><span class="pln"> SQLALCHEMY_MIGRATE_REPO</span><span class="pun">))</span></code></pre>
<p>This script will downgrade the database one revision. You can run it multiple times to downgrade several revisions.</p>
<h2>Database relationships</h2>
<p>Relational databases are good at storing relations between data 
items. Consider the case of a user writing a blog post. The user will 
have a record in the <code>users</code> table, and the post will have a record in the <code>posts</code> table. The most efficient way to record who wrote a given post is to link the two related records.</p>
<p>Once a link between a user and a post is established there are two 
types of queries that we may need to use. The most trivial one is when 
you have a blog post and need to know what user wrote it. A more complex
 query is the reverse of this one. If you have a user, you may want to 
know all the posts that the user wrote. Flask-SQLAlchemy will help us 
with both types of queries.</p>
<p>Let's expand our database to store posts, so that we can see 
relationships in action. For this we go back to our database design tool
 and create a <code>posts</code> table:</p>
<p><img alt="users table" src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/flask-mega-tutorial-part-iv-2.png"></p>
<p>Our <code>posts</code> table will have the required <code>id</code>, the <code>body</code> of the post and a <code>timestamp</code>. Not much new there. But the <code>user_id</code> field deserves an explanation.</p>
<p>We said we wanted to link users to the posts that they write. The way
 to do that is by adding a field to the post that contains the <code>id</code> of the user that wrote it. This <code>id</code> is called a <em>foreign key</em>. Our database design tool shows foreign keys as a link between the foreign key and the <code>id</code> field of the table it refers to. This kind of link is called a one-to-many relationship, <em>one</em> user writes <em>many</em> posts.</p>
<p>Let's modify our models to reflect these changes (<code>app/models.py</code>):</p>
<pre class="prettyprint"><code><span class="kwd">from</span><span class="pln"> app </span><span class="kwd">import</span><span class="pln"> db

ROLE_USER </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
ROLE_ADMIN </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">User</span><span class="pun">(</span><span class="pln">db</span><span class="pun">.</span><span class="typ">Model</span><span class="pun">):</span><span class="pln">
    id </span><span class="pun">=</span><span class="pln"> db</span><span class="pun">.</span><span class="typ">Column</span><span class="pun">(</span><span class="pln">db</span><span class="pun">.</span><span class="typ">Integer</span><span class="pun">,</span><span class="pln"> primary_key </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">True</span><span class="pun">)</span><span class="pln">
    nickname </span><span class="pun">=</span><span class="pln"> db</span><span class="pun">.</span><span class="typ">Column</span><span class="pun">(</span><span class="pln">db</span><span class="pun">.</span><span class="typ">String</span><span class="pun">(</span><span class="lit">64</span><span class="pun">),</span><span class="pln"> unique </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">True</span><span class="pun">)</span><span class="pln">
    email </span><span class="pun">=</span><span class="pln"> db</span><span class="pun">.</span><span class="typ">Column</span><span class="pun">(</span><span class="pln">db</span><span class="pun">.</span><span class="typ">String</span><span class="pun">(</span><span class="lit">120</span><span class="pun">),</span><span class="pln"> unique </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">True</span><span class="pun">)</span><span class="pln">
    role </span><span class="pun">=</span><span class="pln"> db</span><span class="pun">.</span><span class="typ">Column</span><span class="pun">(</span><span class="pln">db</span><span class="pun">.</span><span class="typ">SmallInteger</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> ROLE_USER</span><span class="pun">)</span><span class="pln">
    posts </span><span class="pun">=</span><span class="pln"> db</span><span class="pun">.</span><span class="pln">relationship</span><span class="pun">(</span><span class="str">'Post'</span><span class="pun">,</span><span class="pln"> backref </span><span class="pun">=</span><span class="pln"> </span><span class="str">'author'</span><span class="pun">,</span><span class="pln"> lazy </span><span class="pun">=</span><span class="pln"> </span><span class="str">'dynamic'</span><span class="pun">)</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> __repr__</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">):</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="str">'&lt;User %r&gt;'</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">self</span><span class="pun">.</span><span class="pln">nickname</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Post</span><span class="pun">(</span><span class="pln">db</span><span class="pun">.</span><span class="typ">Model</span><span class="pun">):</span><span class="pln">
    id </span><span class="pun">=</span><span class="pln"> db</span><span class="pun">.</span><span class="typ">Column</span><span class="pun">(</span><span class="pln">db</span><span class="pun">.</span><span class="typ">Integer</span><span class="pun">,</span><span class="pln"> primary_key </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">True</span><span class="pun">)</span><span class="pln">
    body </span><span class="pun">=</span><span class="pln"> db</span><span class="pun">.</span><span class="typ">Column</span><span class="pun">(</span><span class="pln">db</span><span class="pun">.</span><span class="typ">String</span><span class="pun">(</span><span class="lit">140</span><span class="pun">))</span><span class="pln">
    timestamp </span><span class="pun">=</span><span class="pln"> db</span><span class="pun">.</span><span class="typ">Column</span><span class="pun">(</span><span class="pln">db</span><span class="pun">.</span><span class="typ">DateTime</span><span class="pun">)</span><span class="pln">
    user_id </span><span class="pun">=</span><span class="pln"> db</span><span class="pun">.</span><span class="typ">Column</span><span class="pun">(</span><span class="pln">db</span><span class="pun">.</span><span class="typ">Integer</span><span class="pun">,</span><span class="pln"> db</span><span class="pun">.</span><span class="typ">ForeignKey</span><span class="pun">(</span><span class="str">'user.id'</span><span class="pun">))</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> __repr__</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">):</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="str">'&lt;Post %r&gt;'</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">self</span><span class="pun">.</span><span class="pln">body</span><span class="pun">)</span></code></pre>
<p>We have added the <code>Post</code> class, which will represent blog posts written by users. The <code>user_id</code> field in the <code>Post</code> class was initialized as a <em>foreign key</em>, so that Flask-SQLAlchemy knows that this field will link to a user.</p>
<p>Note that we have also added a new field to the <code>User</code> class called <code>posts</code>, that is constructed as a <code>db.relationship</code> field. This is not an actual database field, so it isn't in our database diagram. For a one-to-many relationship a <code>db.relationship</code> field is normally defined on the "one" side. With this relationship we get a <code>user.posts</code> member that gets us the list of posts from the user. The first argument to <code>db.relationship</code> indicates the "many" class of this relationship. The <code>backref</code>
 argument defines a field that will be added to the objects of the 
"many" class that points back at the "one" object. In our case this 
means that we can use <code>post.author</code> to get the User instance 
that created a post. Don't worry if these details don't make much sense 
just yet, we'll see examples of this at the end of this article.</p>
<p>Let's record another migration with this change. Simply run:</p>
<pre class="prettyprint"><code><span class="pun">./</span><span class="pln">db_migrate</span><span class="pun">.</span><span class="pln">py</span></code></pre>
<p>And the script will respond:</p>
<pre class="prettyprint"><code><span class="typ">New</span><span class="pln"> migration saved </span><span class="kwd">as</span><span class="pln"> db_repository</span><span class="pun">/</span><span class="pln">versions</span><span class="pun">/</span><span class="lit">002</span><span class="pln">_migration</span><span class="pun">.</span><span class="pln">py
</span><span class="typ">Current</span><span class="pln"> database version</span><span class="pun">:</span><span class="pln"> </span><span class="lit">2</span></code></pre>
<p>It isn't really necessary to record each little change to the 
database model as a separate migration, a migration is normally only 
recorded at release points. We are doing more migrations than necessary 
here only to show how the migration system works.</p>
<h2>Play time</h2>
<p>We have spent a lot of time defining our database, but we haven't 
seen how it works yet. Since our app does not have database code yet 
let's make use of our brand new database in the Python interpreter.</p>
<p>So go ahead and fire up Python. On Linux or OS X:</p>
<pre class="prettyprint"><code><span class="pln">flask</span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">python</span></code></pre>
<p>Or on Windows:</p>
<pre class="prettyprint"><code><span class="pln">flask\Scripts\python</span></code></pre>
<p>Once in the Python prompt enter the following:</p>
<pre class="prettyprint"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="kwd">from</span><span class="pln"> app </span><span class="kwd">import</span><span class="pln"> db</span><span class="pun">,</span><span class="pln"> models
</span><span class="pun">&gt;&gt;&gt;</span></code></pre>
<p>This brings our database and models into memory. </p>
<p>Let's create a new user:</p>
<pre class="prettyprint"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> u </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">User</span><span class="pun">(</span><span class="pln">nickname</span><span class="pun">=</span><span class="str">'john'</span><span class="pun">,</span><span class="pln"> email</span><span class="pun">=</span><span class="str">'john@email.com'</span><span class="pun">,</span><span class="pln"> role</span><span class="pun">=</span><span class="pln">models</span><span class="pun">.</span><span class="pln">ROLE_USER</span><span class="pun">)</span><span class="pln">
</span><span class="pun">&gt;&gt;&gt;</span><span class="pln"> db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">u</span><span class="pun">)</span><span class="pln">
</span><span class="pun">&gt;&gt;&gt;</span><span class="pln"> db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">commit</span><span class="pun">()</span><span class="pln">
</span><span class="pun">&gt;&gt;&gt;</span></code></pre>
<p>Changes to a database are done in the context of a session. Multiple 
changes can be accumulated in a session and once all the changes have 
been registered you can issue a single <code>db.session.commit()</code>, which writes the changes atomically. If at any time while working on a session there is an error, a call to <code>db.session.rollback()</code> will revert the database to its state before the session was started. If neither <code>commit</code> nor <code>rollback</code>
 are issued then the system by default will roll back the session. 
Sessions guarantee that the database will never be left in an 
inconsistent state.</p>
<p>Let's add another user:</p>
<pre class="prettyprint"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> u </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">User</span><span class="pun">(</span><span class="pln">nickname</span><span class="pun">=</span><span class="str">'susan'</span><span class="pun">,</span><span class="pln"> email</span><span class="pun">=</span><span class="str">'susan@email.com'</span><span class="pun">,</span><span class="pln"> role</span><span class="pun">=</span><span class="pln">models</span><span class="pun">.</span><span class="pln">ROLE_USER</span><span class="pun">)</span><span class="pln">
</span><span class="pun">&gt;&gt;&gt;</span><span class="pln"> db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">u</span><span class="pun">)</span><span class="pln">
</span><span class="pun">&gt;&gt;&gt;</span><span class="pln"> db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">commit</span><span class="pun">()</span><span class="pln">
</span><span class="pun">&gt;&gt;&gt;</span></code></pre>
<p>Now we can query what our users are:</p>
<pre class="prettyprint"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> users </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">User</span><span class="pun">.</span><span class="pln">query</span><span class="pun">.</span><span class="pln">all</span><span class="pun">()</span><span class="pln">
</span><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="kwd">print</span><span class="pln"> users
</span><span class="pun">[&lt;</span><span class="typ">User</span><span class="pln"> u</span><span class="str">'john'</span><span class="pun">&gt;,</span><span class="pln"> </span><span class="pun">&lt;</span><span class="typ">User</span><span class="pln"> u</span><span class="str">'susan'</span><span class="pun">&gt;]</span><span class="pln">
</span><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> u </span><span class="kwd">in</span><span class="pln"> users</span><span class="pun">:</span><span class="pln">
</span><span class="pun">...</span><span class="pln">     </span><span class="kwd">print</span><span class="pln"> u</span><span class="pun">.</span><span class="pln">id</span><span class="pun">,</span><span class="pln">u</span><span class="pun">.</span><span class="pln">nickname
</span><span class="pun">...</span><span class="pln">
</span><span class="lit">1</span><span class="pln"> john
</span><span class="lit">2</span><span class="pln"> susan
</span><span class="pun">&gt;&gt;&gt;</span></code></pre>
<p>For this we have used the <code>query</code> member, which is available in all model classes. Note how the <code>id</code> member was automatically set for us.</p>
<p>Here is another way to do queries. If we know the <code>id</code> of a user we can find the data for that user as follows:</p>
<pre class="prettyprint"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> u </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">User</span><span class="pun">.</span><span class="pln">query</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln">
</span><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="kwd">print</span><span class="pln"> u
</span><span class="pun">&lt;</span><span class="typ">User</span><span class="pln"> u</span><span class="str">'john'</span><span class="pun">&gt;</span><span class="pln">
</span><span class="pun">&gt;&gt;&gt;</span></code></pre>
<p>Now let's add a blog post:</p>
<pre class="prettyprint"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="kwd">import</span><span class="pln"> datetime
</span><span class="pun">&gt;&gt;&gt;</span><span class="pln"> u </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">User</span><span class="pun">.</span><span class="pln">query</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln">
</span><span class="pun">&gt;&gt;&gt;</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">Post</span><span class="pun">(</span><span class="pln">body</span><span class="pun">=</span><span class="str">'my first post!'</span><span class="pun">,</span><span class="pln"> timestamp</span><span class="pun">=</span><span class="pln">datetime</span><span class="pun">.</span><span class="pln">datetime</span><span class="pun">.</span><span class="pln">utcnow</span><span class="pun">(),</span><span class="pln"> author</span><span class="pun">=</span><span class="pln">u</span><span class="pun">)</span><span class="pln">
</span><span class="pun">&gt;&gt;&gt;</span><span class="pln"> db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">p</span><span class="pun">)</span><span class="pln">
</span><span class="pun">&gt;&gt;&gt;</span><span class="pln"> db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">commit</span><span class="pun">()</span></code></pre>
<p>Here we set our <code>timestamp</code> in UTC time zone. All 
timestamps stored in our database will be in UTC. We can have users from
 all over the world writing posts and we need to use uniform time units.
 In a future tutorial we will see how to show these times to users in 
their local timezone.</p>
<p>You may have noticed that we have not set the <code>user_id</code> field of the Post class. Instead, we are storing a User object inside the <code>author</code> field. The <code>author</code>
 field is a virtual field that was added by Flask-SQLAlchemy to help 
with relationships, we have defined the name of this field in the <code>backref</code> argument to <code>db.relationship</code> in our model. With this information the ORM layer will know how to complete the <code>user_id</code> for us.</p>
<p>To complete this session, let's look at a few more database queries that we can do:</p>
<pre class="prettyprint"><code><span class="com"># get all posts from a user</span><span class="pln">
</span><span class="pun">&gt;&gt;&gt;</span><span class="pln"> u </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">User</span><span class="pun">.</span><span class="pln">query</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln">
</span><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="kwd">print</span><span class="pln"> u
</span><span class="pun">&lt;</span><span class="typ">User</span><span class="pln"> u</span><span class="str">'john'</span><span class="pun">&gt;</span><span class="pln">
</span><span class="pun">&gt;&gt;&gt;</span><span class="pln"> posts </span><span class="pun">=</span><span class="pln"> u</span><span class="pun">.</span><span class="pln">posts</span><span class="pun">.</span><span class="pln">all</span><span class="pun">()</span><span class="pln">
</span><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="kwd">print</span><span class="pln"> posts
</span><span class="pun">[&lt;</span><span class="typ">Post</span><span class="pln"> u</span><span class="str">'my first post!'</span><span class="pun">&gt;]</span><span class="pln">

</span><span class="com"># obtain author of each post</span><span class="pln">
</span><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> p </span><span class="kwd">in</span><span class="pln"> posts</span><span class="pun">:</span><span class="pln">
</span><span class="pun">...</span><span class="pln">     </span><span class="kwd">print</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">id</span><span class="pun">,</span><span class="pln">p</span><span class="pun">.</span><span class="pln">author</span><span class="pun">.</span><span class="pln">nickname</span><span class="pun">,</span><span class="pln">p</span><span class="pun">.</span><span class="pln">body
</span><span class="pun">...</span><span class="pln">
</span><span class="lit">1</span><span class="pln"> john </span><span class="kwd">my</span><span class="pln"> first post</span><span class="pun">!</span><span class="pln">

</span><span class="com"># a user that has no posts</span><span class="pln">
</span><span class="pun">&gt;&gt;&gt;</span><span class="pln"> u </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">User</span><span class="pun">.</span><span class="pln">query</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln">
</span><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="kwd">print</span><span class="pln"> u
</span><span class="pun">&lt;</span><span class="typ">User</span><span class="pln"> u</span><span class="str">'susan'</span><span class="pun">&gt;</span><span class="pln">
</span><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="kwd">print</span><span class="pln"> u</span><span class="pun">.</span><span class="pln">posts</span><span class="pun">.</span><span class="pln">all</span><span class="pun">()</span><span class="pln">
</span><span class="pun">[]</span><span class="pln">

</span><span class="com"># get all users in reverse alphabetical order</span><span class="pln">
</span><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="kwd">print</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">User</span><span class="pun">.</span><span class="pln">query</span><span class="pun">.</span><span class="pln">order_by</span><span class="pun">(</span><span class="str">'nickname desc'</span><span class="pun">).</span><span class="pln">all</span><span class="pun">()</span><span class="pln">
</span><span class="pun">[&lt;</span><span class="typ">User</span><span class="pln"> u</span><span class="str">'susan'</span><span class="pun">&gt;,</span><span class="pln"> </span><span class="pun">&lt;</span><span class="typ">User</span><span class="pln"> u</span><span class="str">'john'</span><span class="pun">&gt;]</span><span class="pln">
</span><span class="pun">&gt;&gt;&gt;</span></code></pre>
<p>The <a href="http://packages.python.org/Flask-SQLAlchemy/index.html">Flask-SQLAlchemy</a> documentation is the best place to learn about the many options that are available to query the database.</p>
<p>Before we close, let's erase the test users and posts we have 
created, so that we can start from a clean database in the next chapter:</p>
<pre class="prettyprint"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> users </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">User</span><span class="pun">.</span><span class="pln">query</span><span class="pun">.</span><span class="pln">all</span><span class="pun">()</span><span class="pln">
</span><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> u </span><span class="kwd">in</span><span class="pln"> users</span><span class="pun">:</span><span class="pln">
</span><span class="pun">...</span><span class="pln">     db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="kwd">delete</span><span class="pun">(</span><span class="pln">u</span><span class="pun">)</span><span class="pln">
</span><span class="pun">...</span><span class="pln">
</span><span class="pun">&gt;&gt;&gt;</span><span class="pln"> posts </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">Post</span><span class="pun">.</span><span class="pln">query</span><span class="pun">.</span><span class="pln">all</span><span class="pun">()</span><span class="pln">
</span><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> p </span><span class="kwd">in</span><span class="pln"> posts</span><span class="pun">:</span><span class="pln">
</span><span class="pun">...</span><span class="pln">     db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="kwd">delete</span><span class="pun">(</span><span class="pln">p</span><span class="pun">)</span><span class="pln">
</span><span class="pun">...</span><span class="pln">
</span><span class="pun">&gt;&gt;&gt;</span><span class="pln"> db</span><span class="pun">.</span><span class="pln">session</span><span class="pun">.</span><span class="pln">commit</span><span class="pun">()</span><span class="pln">
</span><span class="pun">&gt;&gt;&gt;</span></code></pre>
<h2>Final words</h2>
<p>This was a long tutorial. We have learned the basics of working with a
 database, but we haven't incorporated the database into our application
 yet. In the next chapter we will put all we have learned about 
databases into practice when we look at our user login system.</p>
<p>In the meantime, if you haven't been writing the application along, you may want to download it in its current state:</p>
<p>Download <a href="https://github.com/miguelgrinberg/microblog/archive/v0.4.zip">microblog-0.4.zip</a>.</p>
<p>Note that I have not included a database in the zip file above, but 
the repository with the migrations is there. To create a new database 
just use the <code>db_create.py</code> script, then use <code>db_upgrade.py</code> to upgrade the database to the latest revision.</p>
<p>I hope to see you next time!</p>
<p>Miguel</p></div>
<div class="social-mini"><table><tbody><tr>
    <td><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-iv-database" data-via="miguelgrinberg" data-count="none">Tweet</a></td>
    <td><g:plusone href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-iv-database" size="medium" witdh="100" annotation="none"></g:plusone></td>
    <td><script type="IN/Share" data-url="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-iv-database"></script></td>
    <td><div style="display: block;" class="fb-like" data-href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-iv-database" data-send="false" data-layout="button_count" data-width="100" data-show-faces="false" data-font="verdana"><iframe style="width: 30px; height: 19px; border: 0px none;" id="bslvqjlmoqrsdhkvgbsvcphxnjlzcmtf"></iframe></div></td>
</tr></tbody></table></div>

<h4 style="text-align: right"><a name="comments"></a>203 comments</h4>


<div class="comment">
    <ul>
        
        <li>
            <div class="comment-thumbnail"></div>
            <div class="comment-body">
                <p>
                    <span class="label">#1</span> <span class="label label-info">Alexander Manenko</span> said
                    <script type="text/javascript">
                    document.write(moment("2012-05-20T10:50:32Z").fromNow());
                    </script>2 years ago:
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Thank you for this article!</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"></div>
            <div class="comment-body">
                <p>
                    <span class="label">#2</span> <span class="label label-info">Doug</span> said
                    <script type="text/javascript">
                    document.write(moment("2012-06-26T20:45:37Z").fromNow());
                    </script>2 years ago:
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">First off, I just 
wanted to say that I love the flask tutorials, and look forward to more 
in the future. They are a huge help! Unfortunately, I am having a bit of
 trouble with the migration script and was wondering if you might be 
able to offer any insight. Inside of my models, I have the following 
column: 
date_added = db.Column(db.DateTime, default=datetime.datetime.utcnow)

When I run db_migrate.py it converts that into the following line inside
 of my migration: 
Column('date_added', DateTime, default=ColumnDefault(&lt;function 
&lt;lambda&gt; at 0x101dddd70&gt;))

Later, when this line of the db_migrate.py script hits that line it 
causes a SyntaxError:
a = api.upgrade(SQLALCHEMY_DATABASE_URI, SQLALCHEMY_MIGRATE_REPO)

Any thoughts?</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"></div>
            <div class="comment-body">
                <p>
                    <span class="label">#3</span> <span class="label label-important">Miguel Grinberg</span> said
                    <script type="text/javascript">
                    document.write(moment("2012-06-27T00:01:28Z").fromNow());
                    </script>2 years ago:
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Hi Doug, thanks 
for your comments.
I couldn't find anything in writing that explains the problem, but it is
 clear that sqlalchemy-migrate does not know how to handle a column 
default that is a function instead of a regular value. The automatic 
generation of migration scripts is an experimental feature, so this may 
be one of the aspects that isn't very polished. Maybe if you fix the 
migration script by hand to have the default function it will work.
As a side comment, I prefer not to use these sort of implicit updates 
that happen outside of your control, as I believe they make the code 
harder to understand and maintain. I like changes to the database to be 
explicit and always under my control, so I always update fields myself.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"></div>
            <div class="comment-body">
                <p>
                    <span class="label">#4</span> <span class="label label-info"><a href="http://bentortora.com/">Ben</a></span> said
                    <script type="text/javascript">
                    document.write(moment("2012-07-03T09:16:28Z").fromNow());
                    </script>2 years ago:
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Hi Miguel,

Thanks for these, they are amazingly helpful. 

I am currently having some issues querying against all posts from a date
 range, eg. The date 7 days. The issue comes from the fact that the 
datetime format doesn't recognize just the date part. 

I could not find much in the sqlalchemy documentation about it. 

Any help would be appreciated!

Thanks,

Ben</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/729e26a2a2c7ff24a71958d4aa4e5f35.jpg"></div>
            <div class="comment-body">
                <p>
                    <span class="label">#5</span> <span class="label label-important">Miguel Grinberg</span> said
                    <script type="text/javascript">
                    document.write(moment("2012-07-03T16:34:37Z").fromNow());
                    </script>2 years ago:
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Hi Ben, thanks for
 following the tutorial. To find posts that are in a date range you can 
use the filter() method of the query class. For example, if you want all
 posts between 2012-04-20 and 2012-04-27 you would do this: 
Post.query.filter(Post.date &gt;= datetime(2012,4,20), Post.date &lt; 
datetime(2012,4,27)). Note that the way I constructed the query you will
 get all the posts from the 20th to (and including) the 26th, but 
nothing from the 27th. If you wanted to include the 27th then you would 
say Post.date &lt; datetime(2012,4,28). I hope this makes sense. Thanks!</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/5ae4402fd8da55d8d4c6580dc909ae2a.png"></div>
            <div class="comment-body">
                <p>
                    <span class="label">#6</span> <span class="label label-info">Doug</span> said
                    <script type="text/javascript">
                    document.write(moment("2012-07-03T16:39:29Z").fromNow());
                    </script>2 years ago:
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Miguel, you are 
awesome for responding to your comments so quickly! I wanted to say 
thank you for your response to mine last week. I came to the same 
conclusion as you about sqlalchemy-migrate not being able to handle 
functions as column defaults; Hopefully they address this in a future 
update. I was able to sidestep the issue by specifying the function as 
my default value in the model's constructor. Keep up the excellent work!</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"></div>
            <div class="comment-body">
                <p>
                    <span class="label">#7</span> <span class="label label-info">smitty</span> said
                    <script type="text/javascript">
                    document.write(moment("2012-07-18T15:52:03Z").fromNow());
                    </script>2 years ago:
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">I went kinda crazy
 trying to use the introductory Flask examples with SQLalchemy. Chapter 
18 of the Flask documentation seems key for defining a data model as a 
singly .py file, and then getting it to play nicely with Flask.
In my medium-weight pythonista opinion, the whole business of factory 
methods and function decorators cuts against the grain of the KISS 
principle that motivates python in general.
Possibly that is all 'nature of the beast'.
Cheers,
Chris</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"></div>
            <div class="comment-body">
                <p>
                    <span class="label">#8</span> <span class="label label-info">JonoB</span> said
                    <script type="text/javascript">
                    document.write(moment("2012-07-19T12:36:33Z").fromNow());
                    </script>2 years ago:
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">When I run ./db_create.py, i get a Permission denied error. What am I doing wrong?</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/b50f24a5349355a5ce3845f2d1e1cf7e.png"></div>
            <div class="comment-body">
                <p>
                    <span class="label">#9</span> <span class="label label-info">JonoB</span> said
                    <script type="text/javascript">
                    document.write(moment("2012-07-19T12:55:12Z").fromNow());
                    </script>2 years ago:
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">OK, fixed the permission issue. But now when I run ./db_create.py I get the following errors:
from: can't read /var/mail/migrate.versioning
from: can't read /var/mail/config
from: can't read /var/mail/config
line4: import: command not found
...etc
...etc</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/b50f24a5349355a5ce3845f2d1e1cf7e.png"></div>
            <div class="comment-body">
                <p>
                    <span class="label">#10</span> <span class="label label-info">JonoB</span> said
                    <script type="text/javascript">
                    document.write(moment("2012-07-19T14:04:32Z").fromNow());
                    </script>2 years ago:
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Finally managed to sort this out. Ignore the shebang stuff. Just type:
python db_create.py

Also, __FILE__ should be __file__

Finally, the hyperlink to the file download doesn't work.</p>
                </div>
            </div>
        </li>
        
    </ul>
    <!--
    <table width="100%">
    
    <tr>
        <td width="60px"><img src="http://gravatar.com/avatar/441a790c0691b139c473c8944b1d2579?s=60&d=identicon" /></td>
        <td>
            <p>
                <span class="label">#1</span> <span class="label label-info">Alexander Manenko</span> said
                <script type="text/javascript">
                document.write(moment("2012-05-20T10:50:32Z").fromNow());
                </script>:
            </p>
            <div style="overflow: auto;">
                <p style="white-space: pre-wrap;">Thank you for this article!aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</p>
            </div>
        </td>
    </tr>
    
    <tr>
        <td width="60px"><img src="http://gravatar.com/avatar/5ae4402fd8da55d8d4c6580dc909ae2a?s=60&d=identicon" /></td>
        <td>
            <p>
                <span class="label">#2</span> <span class="label label-info">Doug</span> said
                <script type="text/javascript">
                document.write(moment("2012-06-26T20:45:37Z").fromNow());
                </script>:
            </p>
            <div style="overflow: auto;">
                <p style="white-space: pre-wrap;">First off, I just wanted to say that I love the flask tutorials, and look forward to more in the future. They are a huge help! Unfortunately, I am having a bit of trouble with the migration script and was wondering if you might be able to offer any insight. Inside of my models, I have the following column: 
date_added = db.Column(db.DateTime, default=datetime.datetime.utcnow)

When I run db_migrate.py it converts that into the following line inside of my migration: 
Column(&#39;date_added&#39;, DateTime, default=ColumnDefault(&lt;function &lt;lambda&gt; at 0x101dddd70&gt;))

Later, when this line of the db_migrate.py script hits that line it causes a SyntaxError:
a = api.upgrade(SQLALCHEMY_DATABASE_URI, SQLALCHEMY_MIGRATE_REPO)

Any thoughts?aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</p>
            </div>
        </td>
    </tr>
    
    <tr>
        <td width="60px"><img src="http://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&d=identicon" /></td>
        <td>
            <p>
                <span class="label">#3</span> <span class="label label-important">Miguel Grinberg</span> said
                <script type="text/javascript">
                document.write(moment("2012-06-27T00:01:28Z").fromNow());
                </script>:
            </p>
            <div style="overflow: auto;">
                <p style="white-space: pre-wrap;">Hi Doug, thanks for your comments.
I couldn&#39;t find anything in writing that explains the problem, but it is clear that sqlalchemy-migrate does not know how to handle a column default that is a function instead of a regular value. The automatic generation of migration scripts is an experimental feature, so this may be one of the aspects that isn&#39;t very polished. Maybe if you fix the migration script by hand to have the default function it will work.
As a side comment, I prefer not to use these sort of implicit updates that happen outside of your control, as I believe they make the code harder to understand and maintain. I like changes to the database to be explicit and always under my control, so I always update fields myself.aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</p>
            </div>
        </td>
    </tr>
    
    <tr>
        <td width="60px"><img src="http://gravatar.com/avatar/269de9b87f819b49f25d3fbf6fc51061?s=60&d=identicon" /></td>
        <td>
            <p>
                <span class="label">#4</span> <span class="label label-info"><a href="Http://bentortora.com">Ben</a></span> said
                <script type="text/javascript">
                document.write(moment("2012-07-03T09:16:28Z").fromNow());
                </script>:
            </p>
            <div style="overflow: auto;">
                <p style="white-space: pre-wrap;">Hi Miguel,

Thanks for these, they are amazingly helpful. 

I am currently having some issues querying against all posts from a date range, eg. The date 7 days. The issue comes from the fact that the datetime format doesn&#39;t recognize just the date part. 

I could not find much in the sqlalchemy documentation about it. 

Any help would be appreciated!

Thanks,

Benaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</p>
            </div>
        </td>
    </tr>
    
    <tr>
        <td width="60px"><img src="http://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&d=identicon" /></td>
        <td>
            <p>
                <span class="label">#5</span> <span class="label label-important">Miguel Grinberg</span> said
                <script type="text/javascript">
                document.write(moment("2012-07-03T16:34:37Z").fromNow());
                </script>:
            </p>
            <div style="overflow: auto;">
                <p style="white-space: pre-wrap;">Hi Ben, thanks for following the tutorial. To find posts that are in a date range you can use the filter() method of the query class. For example, if you want all posts between 2012-04-20 and 2012-04-27 you would do this: Post.query.filter(Post.date &gt;= datetime(2012,4,20), Post.date &lt; datetime(2012,4,27)). Note that the way I constructed the query you will get all the posts from the 20th to (and including) the 26th, but nothing from the 27th. If you wanted to include the 27th then you would say Post.date &lt; datetime(2012,4,28). I hope this makes sense. Thanks!aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</p>
            </div>
        </td>
    </tr>
    
    <tr>
        <td width="60px"><img src="http://gravatar.com/avatar/5ae4402fd8da55d8d4c6580dc909ae2a?s=60&d=identicon" /></td>
        <td>
            <p>
                <span class="label">#6</span> <span class="label label-info">Doug</span> said
                <script type="text/javascript">
                document.write(moment("2012-07-03T16:39:29Z").fromNow());
                </script>:
            </p>
            <div style="overflow: auto;">
                <p style="white-space: pre-wrap;">Miguel, you are awesome for responding to your comments so quickly! I wanted to say thank you for your response to mine last week. I came to the same conclusion as you about sqlalchemy-migrate not being able to handle functions as column defaults; Hopefully they address this in a future update. I was able to sidestep the issue by specifying the function as my default value in the model&#39;s constructor. Keep up the excellent work!aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</p>
            </div>
        </td>
    </tr>
    
    <tr>
        <td width="60px"><img src="http://gravatar.com/avatar/36bfb43c27ac18bb006329eb2c9ccd4c?s=60&d=identicon" /></td>
        <td>
            <p>
                <span class="label">#7</span> <span class="label label-info">smitty</span> said
                <script type="text/javascript">
                document.write(moment("2012-07-18T15:52:03Z").fromNow());
                </script>:
            </p>
            <div style="overflow: auto;">
                <p style="white-space: pre-wrap;">I went kinda crazy trying to use the introductory Flask examples with SQLalchemy. Chapter 18 of the Flask documentation seems key for defining a data model as a singly .py file, and then getting it to play nicely with Flask.
In my medium-weight pythonista opinion, the whole business of factory methods and function decorators cuts against the grain of the KISS principle that motivates python in general.
Possibly that is all &#39;nature of the beast&#39;.
Cheers,
Chrisaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</p>
            </div>
        </td>
    </tr>
    
    <tr>
        <td width="60px"><img src="http://gravatar.com/avatar/b50f24a5349355a5ce3845f2d1e1cf7e?s=60&d=identicon" /></td>
        <td>
            <p>
                <span class="label">#8</span> <span class="label label-info">JonoB</span> said
                <script type="text/javascript">
                document.write(moment("2012-07-19T12:36:33Z").fromNow());
                </script>:
            </p>
            <div style="overflow: auto;">
                <p style="white-space: pre-wrap;">When I run ./db_create.py, i get a Permission denied error. What am I doing wrong?aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</p>
            </div>
        </td>
    </tr>
    
    <tr>
        <td width="60px"><img src="http://gravatar.com/avatar/b50f24a5349355a5ce3845f2d1e1cf7e?s=60&d=identicon" /></td>
        <td>
            <p>
                <span class="label">#9</span> <span class="label label-info">JonoB</span> said
                <script type="text/javascript">
                document.write(moment("2012-07-19T12:55:12Z").fromNow());
                </script>:
            </p>
            <div style="overflow: auto;">
                <p style="white-space: pre-wrap;">OK, fixed the permission issue. But now when I run ./db_create.py I get the following errors:
from: can&#39;t read /var/mail/migrate.versioning
from: can&#39;t read /var/mail/config
from: can&#39;t read /var/mail/config
line4: import: command not found
...etc
...etcaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</p>
            </div>
        </td>
    </tr>
    
    <tr>
        <td width="60px"><img src="http://gravatar.com/avatar/b50f24a5349355a5ce3845f2d1e1cf7e?s=60&d=identicon" /></td>
        <td>
            <p>
                <span class="label">#10</span> <span class="label label-info">JonoB</span> said
                <script type="text/javascript">
                document.write(moment("2012-07-19T14:04:32Z").fromNow());
                </script>:
            </p>
            <div style="overflow: auto;">
                <p style="white-space: pre-wrap;">Finally managed to sort this out. Ignore the shebang stuff. Just type:
python db_create.py

Also, __FILE__ should be __file__

Finally, the hyperlink to the file download doesn&#39;t work.aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</p>
            </div>
        </td>
    </tr>
    
    </table>
    -->
</div>

<div class="page">
<ul class="pager">
  <li class="previous disabled">
    <a href="#">««</a>
  </li>
  <li class="previous disabled">
    <a href="#">«</a>
  </li>
  <li class="next">
    <a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-iv-database/page/0#comments">»»</a>
  </li>
  <li class="next">
    <a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-iv-database/page/2#comments">»</a>
  </li>
</ul>
</div>

<h3><a name="commentform"></a>Leave a Comment</h3>
<div class="commentform">
<form class="form-horizontal" method="post" action="#commentform">
<div style="display:none;"><input id="csrf_token" name="csrf_token" value="20140210210102##33a702bac2e53a297d97fece7d12464acbd0976b" type="hidden"></div>

<div class="control-group">
    <label class="control-label" for="name">Name <span class="label label-important">*</span></label>
    <div class="controls"><input class="span5" id="name" name="name" type="text"></div>
</div>
<div class="control-group">
    <label class="control-label" for="url">Website</label>
    <div class="controls"><input class="span5" id="url" name="url" type="text"></div>
</div>
<div class="control-group">
    <label class="control-label" for="email">Email <span class="label label-important">*</span></label>
    <div class="controls"><input class="span5" id="email" name="email" type="text"></div>
</div>

<div class="control-group">
    <label class="control-label" for="comment">Comment <span class="label label-important">*</span></label>
    <div class="controls"><textarea class="span5" id="comment" name="comment" rows="4"></textarea><img style="cursor: pointer ! important; display: none ! important; position: absolute ! important; padding: 0px ! important; margin: 0px ! important; border: medium none ! important; width: 28px ! important; height: 14px ! important; opacity: 0.0152174 ! important; left: 664px ! important; top: 15356px ! important;" title="It's All Text!" src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/gumdrop.png"></div>
</div>

<div class="control-group">
    <div class="controls">
<script type="text/javascript">var RecaptchaOptions = {"theme": "white", "custom_translations": {"incorrect_try_again": "Incorrect. Try again.", "help_btn": "Help", "cant_hear_this": "Download sound as MP3", "instructions_audio": "Type what you hear:", "instructions_visual": "Type the two words:", "refresh_btn": "Get a new challenge", "play_again": "Play sound again", "visual_challenge": "Get a visual challenge", "audio_challenge": "Get an audio challenge"}};</script>
<script type="text/javascript" src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/challenge.js"></script><script type="text/javascript" src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/recaptcha.js"></script><div class=" recaptcha_nothad_incorrect_sol recaptcha_isnot_showing_audio" id="recaptcha_widget_div" style=""><div id="recaptcha_area"><table id="recaptcha_table" class="recaptchatable recaptcha_theme_white"> <tbody><tr> <td colspan="6" class="recaptcha_r1_c1"></td> </tr> <tr> <td class="recaptcha_r2_c1"></td> <td colspan="4" class="recaptcha_image_cell"><center><div style="width: 300px; height: 57px;" id="recaptcha_image"><img id="recaptcha_challenge_image" alt="reCAPTCHA challenge image" src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/image.jpg" height="57" width="300"></div></center></td> <td class="recaptcha_r2_c2"></td> </tr> <tr> <td rowspan="6" class="recaptcha_r3_c1"></td> <td colspan="4" class="recaptcha_r3_c2"></td> <td rowspan="6" class="recaptcha_r3_c3"></td> </tr> <tr> <td rowspan="3" class="recaptcha_r4_c1" height="49"> <div class="recaptcha_input_area"> <span style="display: none;" id="recaptcha_challenge_field_holder"><input name="recaptcha_challenge_field" id="recaptcha_challenge_field" value="03AHJ_Vuvgy4Kz43OGbWAjW5AOa5XXQpqnmVII4myUUaBBh7LAYAj82f4uho6TaCzvwakCFSPrgy61ItBTarsop9EI7NfRSH1a-1ONhWSiVzzLUIVayZAKRR_zdN8MQ403p_nVVyBsi-_ZI2Sixh7Z7QIYWy1Qd6FQ18_1s0JiC93y7KbQMj32sBs" type="hidden"></span><input autocomplete="off" name="recaptcha_response_field" id="recaptcha_response_field" autocorrect="off" autocapitalize="off" placeholder="Type the two words" type="text"> <span id="recaptcha_privacy" class="recaptcha_only_if_privacy"><a target="_blank" href="http://www.google.com/intl/en/policies/">Privacy &amp; Terms</a></span> </div> </td> <td rowspan="4" class="recaptcha_r4_c2"></td> <td><a title="Get a new challenge" id="recaptcha_reload_btn"><img alt="Get a new challenge" src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/refresh.gif" id="recaptcha_reload" height="17" width="25"></a></td> <td rowspan="4" class="recaptcha_r4_c4"></td> </tr> <tr> <td><a title="Get an audio challenge" id="recaptcha_switch_audio_btn" class="recaptcha_only_if_image"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/audio.gif" id="recaptcha_switch_audio" alt="Get an audio challenge" height="16" width="25"></a><a title="Get a visual challenge" id="recaptcha_switch_img_btn" class="recaptcha_only_if_audio"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/text.gif" id="recaptcha_switch_img" alt="Get a visual challenge" height="16" width="25"></a></td> </tr> <tr> <td><a title="Help" id="recaptcha_whatsthis_btn"><img alt="Help" src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/help.gif" id="recaptcha_whatsthis" height="16" width="25"></a></td> </tr> <tr> <td class="recaptcha_r7_c1"></td> <td class="recaptcha_r8_c1"></td> </tr> </tbody></table> </div></div>
<noscript>
  <div><iframe src="http://api.recaptcha.net/noscript?k=6Ld5Zs4SAAAAAOY0DOi4r18bgHlEaz41qAoRf__S" height="300" width="500"></iframe></div>
  <div><textarea name="recaptcha_challenge_field" rows="3" cols="40"></textarea>
  <input type="hidden" name="recaptcha_response_field" value="manual_challenge"></div>
</noscript>
</div>
</div>

<div class="control-group">
    <div class="controls"><input name="submit" class="btn btn-primary" value="Post Comment" type="submit"> <span class="help-inline">Note: all comments are screened before they are published. Thank you for your patience!</span></div>
</div>
</form>
</div>


</div>

            </div>
        </div>
        <div class="span4">
            <div id="sidebar">
                <h1>About Miguel</h1>
                <img style="float: right; margin: 0px 8px 8px 0px; padding: 4px; border: 1px solid #ccc;" src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/miguel.jpg">
                <p>Welcome to my blog!</p>
                <p>I'm a software engineer, photographer and filmmaker in Portland, Oregon, USA.</p>
                <p>You can also find me on <a href="https://www.facebook.com/miguelgrinbergblog">Facebook</a>, <a href="https://plus.google.com/u/0/117786742456929977820">Google+</a>, <a href="http://www.linkedin.com/in/miguelgrinberg">LinkedIn</a> and <a href="https://twitter.com/#%21/miguelgrinberg">Twitter</a>.</p>
                <p>Thank you for visiting!</p>
                <h1>Flask Web Development Book</h1>
                <p>I'm currently writing a book on web development with 
Python and Flask, to be published by O'Reilly Media in 2014. The 
official site for this book is <a href="http://flaskbook.com/">http://flaskbook.com</a>.</p>
                <center><a href="http://flaskbook.com/"><img style="border: 1px solid black;" src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/flask-book-cover-tiny.png"></a></center>
                <h1>Flask Tutorial at PyCon 2014</h1>
                <p>If you want to learn Flask in a class setting then I 
hope you will consider my upcoming tutorial session at PyCon 2014 in 
Montréal on April 10th, 2014. Visit the <a href="https://us.pycon.org/2014/schedule/presentation/54/">tutorial page</a> for more information. I hope to see you there!</p>
                <center><a href="https://us.pycon.org/2014/schedule/presentation/54/"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/pycon2014-blog-image.png"></a></center>
                
                		<h1>Categories</h1>
		<ul>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Arduino/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/rss-small.png" title="Arduino RSS Feed" label="Arduino RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Arduino">Arduino</a></span> (7)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Blog/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/rss-small.png" title="Blog RSS Feed" label="Blog RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Blog">Blog</a></span> (1)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/C++/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/rss-small.png" title="C++ RSS Feed" label="C++ RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/C++">C++</a></span> (5)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Cloud/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/rss-small.png" title="Cloud RSS Feed" label="Cloud RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Cloud">Cloud</a></span> (1)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Filmmaking/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/rss-small.png" title="Filmmaking RSS Feed" label="Filmmaking RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Filmmaking">Filmmaking</a></span> (6)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Flask/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/rss-small.png" title="Flask RSS Feed" label="Flask RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Flask">Flask</a></span> (28)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Games/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/rss-small.png" title="Games RSS Feed" label="Games RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Games">Games</a></span> (1)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Gear/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/rss-small.png" title="Gear RSS Feed" label="Gear RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Gear">Gear</a></span> (6)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/HTML5/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/rss-small.png" title="HTML5 RSS Feed" label="HTML5 RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/HTML5">HTML5</a></span> (1)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Heroku/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/rss-small.png" title="Heroku RSS Feed" label="Heroku RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Heroku">Heroku</a></span> (1)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Javascript/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/rss-small.png" title="Javascript RSS Feed" label="Javascript RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Javascript">Javascript</a></span> (3)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Movie%20Reviews/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/rss-small.png" title="Movie Reviews RSS Feed" label="Movie Reviews RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Movie%20Reviews">Movie Reviews</a></span> (5)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Netflix/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/rss-small.png" title="Netflix RSS Feed" label="Netflix RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Netflix">Netflix</a></span> (5)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Node.js/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/rss-small.png" title="Node.js RSS Feed" label="Node.js RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Node.js">Node.js</a></span> (1)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Personal/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/rss-small.png" title="Personal RSS Feed" label="Personal RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Personal">Personal</a></span> (1)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Photography/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/rss-small.png" title="Photography RSS Feed" label="Photography RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Photography">Photography</a></span> (6)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Product%20Reviews/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/rss-small.png" title="Product Reviews RSS Feed" label="Product Reviews RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Product%20Reviews">Product Reviews</a></span> (1)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Programming/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/rss-small.png" title="Programming RSS Feed" label="Programming RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Programming">Programming</a></span> (36)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Project%20Management/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/rss-small.png" title="Project Management RSS Feed" label="Project Management RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Project%20Management">Project Management</a></span> (1)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Python/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/rss-small.png" title="Python RSS Feed" label="Python RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Python">Python</a></span> (29)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/REST/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/rss-small.png" title="REST RSS Feed" label="REST RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/REST">REST</a></span> (4)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Raspberry%20Pi/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/rss-small.png" title="Raspberry Pi RSS Feed" label="Raspberry Pi RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Raspberry%20Pi">Raspberry Pi</a></span> (4)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/RhinoSteady/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/rss-small.png" title="RhinoSteady RSS Feed" label="RhinoSteady RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/RhinoSteady">RhinoSteady</a></span> (6)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Robotics/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/rss-small.png" title="Robotics RSS Feed" label="Robotics RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Robotics">Robotics</a></span> (6)</li>
		
			<li><a href="http://blog.miguelgrinberg.com/category/Video/feed"><img src="The%20Flask%20Mega-Tutorial,%20Part%20IV_%20Database%20-%20miguelgrinberg.com_files/rss-small.png" title="Video RSS Feed" label="Video RSS Feed"></a> <span class="label label-info"><a href="http://blog.miguelgrinberg.com/category/Video">Video</a></span> (2)</li>
		
		</ul>

                
            </div>
        </div>
    </div>
	<div id="footer">
        <p class="elapsed">This page was generated in 0.139 seconds.</p>
		<p>© 2013 by Miguel Grinberg. All rights reserved. <a href="mailto:webmaster%20_at_%20miguelgrinberg%20_dot_%20com">Questions?</a></p>
	</div>
</div>
<div id="wrap">
</div>
<div style="display: none;" id="cboxOverlay"></div><div style="display: none; padding-bottom: 42px; padding-right: 42px;" class="" id="colorbox"><div id="cboxWrapper"><div><div style="float: left;" id="cboxTopLeft"></div><div style="float: left;" id="cboxTopCenter"></div><div style="float: left;" id="cboxTopRight"></div></div><div style="clear: left;"><div style="float: left;" id="cboxMiddleLeft"></div><div style="float: left;" id="cboxContent"><div style="width: 0px; height: 0px; overflow: hidden; float: left;" id="cboxLoadedContent"></div><div style="float: left;" id="cboxLoadingOverlay"></div><div style="float: left;" id="cboxLoadingGraphic"></div><div style="float: left;" id="cboxTitle"></div><div style="float: left;" id="cboxCurrent"></div><div style="float: left;" id="cboxNext"></div><div style="float: left;" id="cboxPrevious"></div><div style="float: left;" id="cboxSlideshow"></div><div style="float: left;" id="cboxClose"></div></div><div style="float: left;" id="cboxMiddleRight"></div></div><div style="clear: left;"><div style="float: left;" id="cboxBottomLeft"></div><div style="float: left;" id="cboxBottomCenter"></div><div style="float: left;" id="cboxBottomRight"></div></div></div><div style="position: absolute; width: 9999px; visibility: hidden; display: none;"></div></div></body></html>